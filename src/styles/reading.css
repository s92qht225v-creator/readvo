/**
 * Blim Reading System Styles
 *
 * Design principles:
 * - Screen-first, no PDF recreation
 * - Clear visual hierarchy
 * - Obvious interactive affordances
 * - Accessible focus states
 */

/* =============================================================================
   RESET & BASE
   ============================================================================= */

*,
*::before,
*::after {
  box-sizing: border-box;
}

html {
  -webkit-text-size-adjust: 100%;
  -moz-text-size-adjust: 100%;
  text-size-adjust: 100%;
  scroll-behavior: smooth;
  scroll-padding-top: 60px;
}

body {
  margin: 0;
  padding: 0;
  min-height: 100vh;
  line-height: 1.6;
  color: #1a1a1a;
  background: #fff;
}

/* =============================================================================
   CSS CUSTOM PROPERTIES
   ============================================================================= */

:root {
  /* Colors */
  --color-text: #1a1a1a;
  --color-text-secondary: #666;
  --color-text-translation: #4a5568;
  --color-background: #fff;
  --color-background-hover: #f5f5f5;
  --color-background-section: #fafafa;
  --color-border: #e2e8f0;
  --color-accent: #3182ce;
  --color-accent-light: #ebf8ff;

  /* Typography */
  --font-main: inherit;
  --font-cjk: "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "Noto Sans SC", sans-serif;
  --font-size-base: 18px;
  --font-size-small: 14px;
  --font-size-large: 22px;
  --line-height: 1.8;

  /* Spacing */
  --spacing-xs: 4px;
  --spacing-sm: 8px;
  --spacing-md: 16px;
  --spacing-lg: 24px;
  --spacing-xl: 32px;

  /* Layout */
  --header-height: 60px;
  --bottom-nav-height: 56px;

  /* Shadows */
  --shadow-popup: 0 4px 12px rgba(0, 0, 0, 0.15);

  /* Landing page hero — adjust these in DevTools (Elements > html > :root) */
  --hero-padding-bottom: 700px;
  --hero-card-margin-bottom: -820px;
  --hero-card-translateY: 260px;
}

/* =============================================================================
   PAGE
   ============================================================================= */

.page {
  --font-scale: 1; /* Default scale, overridden by inline style */
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  padding: var(--spacing-lg) var(--spacing-xl);
  padding-top: calc(var(--header-height) + 1em + var(--spacing-lg) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--bottom-nav-height) + 1em + var(--spacing-lg) + env(safe-area-inset-bottom, 0px));
  font-family: var(--font-main);
  font-size: calc(var(--font-size-base) * var(--font-scale));
  line-height: var(--line-height);
  color: var(--color-text);
}

/* Reader header controls (in fixed header) */
.reader__controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
}

/* Pinyin toggle button */
.page__toggle-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 12px;
  min-height: 44px;
  background: #f5f5f5;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.page__toggle-btn:hover {
  background: #e5e5e5;
}

.page__toggle-btn--active {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.page__toggle-btn--active:hover {
  background: #2563eb;
}

.page__toggle-label {
  /* Font inherited from header */
}

/* Language toggle button */
.page__lang-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 12px;
  min-height: 44px;
  background: #fef3c7;
  border: 1px solid #fcd34d;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  color: #92400e;
  cursor: pointer;
  transition: all 0.15s ease;
}

.page__lang-btn:hover {
  background: #fde68a;
}

/* Font size controls */
.page__font-controls {
  display: flex;
  gap: 2px;
  background: #f5f5f5;
  border: 1px solid var(--color-border);
  border-radius: 6px;
  overflow: hidden;
}

.page__font-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 8px 10px;
  min-height: 44px;
  background: transparent;
  border: none;
  font-size: 14px;
  font-weight: 600;
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: all 0.15s ease;
}

.page__font-btn:hover:not(:disabled) {
  background: #e5e5e5;
  color: var(--color-text);
}

.page__font-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
}

.page__font-btn:focus {
  outline: none;
}

/* Page number badge */
.page__number-badge {
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #1a1a1a;
  color: white;
  font-size: 14px;
  font-weight: 600;
  border-radius: 50%;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

@media (min-width: 1200px) {
  .page {
    max-width: 1000px;
  }
}

@media (min-width: 1600px) {
  .page {
    max-width: 1100px;
  }
}

.page__header {
  margin-bottom: var(--spacing-xl);
  padding-bottom: var(--spacing-md);
  border-bottom: 2px solid var(--color-border);
}

.page__number {
  display: block;
  font-size: var(--font-size-small);
  color: var(--color-text-secondary);
  margin-bottom: var(--spacing-xs);
}

.page__title {
  margin: 0;
  font-size: var(--font-size-large);
  font-weight: 600;
  font-family: var(--font-cjk);
}

.page__content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

/* =============================================================================
   LESSON HEADER BANNER
   ============================================================================= */

.lesson-header {
  display: flex;
  align-items: stretch;
  margin-bottom: var(--spacing-xl);
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

/* Lesson number badge (left side) */
.lesson-header__badge {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-lg) var(--spacing-xl);
  background: white;
  min-width: 120px;
}

.lesson-header__number {
  font-size: 48px;
  font-weight: 700;
  color: #dc2626;
  line-height: 1;
}

.lesson-header__label {
  font-size: 18px;
  font-weight: 600;
  color: #dc2626;
  text-transform: uppercase;
  margin-top: var(--spacing-xs);
}

/* Title banner (right side) */
.lesson-header__banner {
  flex: 1;
  display: flex;
  align-items: center;
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  padding: var(--spacing-lg) var(--spacing-xl);
}

.lesson-header__content {
  color: white;
}

.lesson-header__pinyin {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: 16px;
  font-weight: 400;
  opacity: 0.9;
  letter-spacing: 2px;
}

.lesson-header__title {
  margin: 0 0 var(--spacing-sm) 0;
  font-size: 36px;
  font-weight: 700;
  font-family: var(--font-cjk);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

.lesson-header__translation {
  margin: 0;
  font-size: 18px;
  font-weight: 500;
  opacity: 0.95;
}

/* Responsive: Tablet */
@media (max-width: 768px) {
  .lesson-header {
    flex-direction: column;
  }

  .lesson-header__badge {
    flex-direction: row;
    justify-content: flex-start;
    gap: var(--spacing-md);
    padding: var(--spacing-md) var(--spacing-lg);
    min-width: unset;
  }

  .lesson-header__label {
    margin-bottom: 0;
  }

  .lesson-header__number {
    font-size: 48px;
  }

  .lesson-header__banner {
    padding: var(--spacing-md) var(--spacing-lg);
  }

  .lesson-header__title {
    font-size: 28px;
  }

  .lesson-header__pinyin {
    font-size: 14px;
  }

  .lesson-header__translation {
    font-size: 16px;
  }
}

/* Responsive: Mobile */
@media (max-width: 480px) {
  .lesson-header__badge {
    padding: var(--spacing-sm) var(--spacing-md);
  }

  .lesson-header__number {
    font-size: 36px;
  }

  .lesson-header__banner {
    padding: var(--spacing-sm) var(--spacing-md);
  }

  .lesson-header__title {
    font-size: 24px;
  }

  .lesson-header__pinyin {
    font-size: 12px;
  }

  .lesson-header__translation {
    font-size: 14px;
  }
}

/* =============================================================================
   SECTION
   ============================================================================= */

.section {
  padding: 0;
  background: transparent;
}

.section__sentences {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
  padding: var(--spacing-md);
  background: var(--color-background-section);
  border-radius: 0 8px 8px 8px;
}

/* Section type variations - apply background to sentences container */
.section--dialogue .section__sentences {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  padding: var(--spacing-sm) var(--spacing-md);
}

.section--vocabulary .section__header {
  display: none;
}

.section--vocabulary .section__sentences {
  background: #fff;
  padding: var(--spacing-sm) var(--spacing-md);
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
}

/* Each vocabulary item is a 2-column grid: Chinese+pinyin | translation */
.section--vocabulary .sentence {
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

.section--vocabulary .sentence:last-child {
  border-bottom: none;
}

.section--vocabulary .sentence__body {
  display: contents;
}

.section--vocabulary .sentence__text-block {
  display: grid;
  grid-template-columns: 40% 1fr;
  gap: 0 var(--spacing-xl);
  padding: 2px 0;
}

.section--vocabulary .sentence__text-row {
  display: inline;
  grid-column: 1;
  grid-row: 1;
}

.section--vocabulary .sentence__text {
  font-weight: 400;
}

/* Translation in column 2, aligned to top with Chinese text */
.section--vocabulary .sentence__translation-inline {
  color: var(--color-text-translation);
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-style: normal;
  grid-column: 2;
  grid-row: 1;
  align-self: start;
  margin-top: 0.35em;
}

.section--grammar .section__sentences {
  background: #fff;
  gap: 0;
  padding: 0;
}

/* Grammar section - all sentences need padding */
.section--grammar .sentence {
  padding: var(--spacing-sm) var(--spacing-md);
}

/* Grammar section - explanation sentences have green background */
/* Only for sentences that are: not numbered, not checkbox, not indented, not dialogue, and not after a checkbox */
.section--grammar .sentence:not([data-numbered="true"]):not(:has(.sentence__checkbox)):not(.sentence--indented):not(.sentence--dialogue-grid) {
  background: #f0fff4;
}

/* Remove green background from sentences after checkbox (exercise items) */
.section--grammar .sentence:has(.sentence__checkbox) ~ .sentence {
  background: transparent !important;
}

/* Grammar section - dialogue sentences should not have green background */
.section--grammar .sentence--dialogue-grid {
  background: transparent !important;
}

/* Grammar section - checkbox item creates visual break */
.section--grammar .sentence:has(.sentence__checkbox) {
  margin-top: var(--spacing-md);
  padding-top: var(--spacing-md);
}

/* Grammar and Exercise sections - numbered items: align pinyin/translation with Chinese text after number */
.section--grammar .sentence[data-numbered="true"] .sentence__pinyin,
.section--grammar .sentence[data-numbered="true"] .sentence__translation-inline,
.section--exercise .sentence[data-numbered="true"] .sentence__pinyin,
.section--exercise .sentence[data-numbered="true"] .sentence__translation-inline {
  padding-left: 1.8em;
}

/* Grammar table (e.g., currency denominations) */
.grammar-table {
  border: 2px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  margin: var(--spacing-md);
}

.grammar-table__row {
  display: grid;
}

.grammar-table__row + .grammar-table__row {
  border-top: 1px solid var(--color-border);
}

.grammar-table__row--header {
  background: #fff3e0;
  border-bottom: 2px solid var(--color-border);
}

.grammar-table__cell {
  padding: var(--spacing-sm) var(--spacing-md);
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  text-align: center;
}

.grammar-table__cell + .grammar-table__cell {
  border-left: 1px solid var(--color-border);
}

.grammar-table__cell--header {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  padding: var(--spacing-md) var(--spacing-sm);
  text-align: center;
  min-width: 140px;
}

.grammar-table__cell-label {
  font-weight: 600;
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
}

.grammar-table__cell-sub {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text-secondary);
}

/* Indented sentences (dialogue responses in exercises) - legacy, kept for backward compatibility */
.sentence--indented {
  padding-left: calc(var(--spacing-md) + 3em) !important;
}

/* Image-only sentence (textbook table scans, etc.) */
.sentence--image-only {
  padding: var(--spacing-sm) 0;
  display: flex;
  justify-content: center;
}

.sentence__inline-image {
  max-width: 100%;
  height: auto;
  border-radius: 6px;
}

/* Dialogue layout - number inline with text, pinyin/translation below aligned to text */
.sentence--dialogue-grid {
  display: flex;
  flex-direction: row;
  padding: var(--spacing-xs) var(--spacing-md);
}

/* Extra top spacing before A lines (start of new dialogue pair) */
.sentence--dialogue-start {
  padding-top: var(--spacing-sm) !important;
}

/* Tight spacing for B reply lines */
.sentence--dialogue-reply {
  padding-top: 0 !important;
}

.sentence--dialogue-grid > .sentence__number {
  min-width: 2.5em;
  flex-shrink: 0;
  font-weight: 400;
  padding-top: 2px;
}

.sentence--dialogue-grid .sentence__dialogue-content {
  flex: 1;
  display: flex;
  flex-direction: row;
  align-items: flex-start;
}

.sentence--dialogue-grid .sentence__speaker {
  flex-shrink: 0;
  font-weight: 700;
  margin-right: 0.5em;
  padding-top: 2px;
}

.sentence--dialogue-grid .sentence__speaker::after {
  content: "：";
}

.sentence--dialogue-grid .sentence__text-block {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.sentence--dialogue-grid .sentence__text {
  font-weight: 400;
}

.sentence--dialogue-grid .sentence__pinyin {
  color: var(--color-accent);
  font-style: italic;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  margin-top: 2px;
}

.sentence--dialogue-grid .sentence__translation-inline {
  color: var(--color-text-translation);
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  margin-top: 2px;
}

.section--instruction .section__sentences {
  background: #faf5ff;
}

/* --- Objectives: premium card design --- */
.section--objectives {
  background: transparent;
  border-radius: 0;
  overflow: visible;
}

.section--objectives .section__header {
  display: none;
}

.section--objectives .section__content {
  border-radius: 0;
  padding: 0;
}

.section--objectives .section__sentences {
  background: #fff;
  border-radius: 16px;
  padding: 18px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  gap: 0;
}

.section--objectives .sentence {
  display: block;
  padding: 16px 0;
}


.section--objectives .sentence__checkbox {
  display: none;
}

.section--objectives .sentence__body {
  display: block;
}

.section--objectives .sentence__text {
  font-size: calc(18px * var(--font-scale, 1));
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.55;
  display: block;
  padding-left: 16px;
  border-left: 6px solid #C43A35;
}

.section--objectives .sentence__translation-inline {
  font-size: calc(14px * var(--font-scale, 1));
  color: #666;
  font-weight: 400;
  line-height: 1.55;
  margin-top: 8px;
  padding-left: 22px;
  font-style: normal;
}

.section--text .section__header {
  display: none;
}

.section--text .section__context {
  background: #fff;
  border-radius: 16px;
  padding: 18px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  margin-bottom: var(--spacing-lg);
}

.section--text .section__context-translation {
  border-top: 1px solid #e5e5e5;
  padding-top: 12px;
  margin-top: 12px;
}

.section__audio-btn--inline {
  display: inline-flex;
  vertical-align: middle;
  margin-left: 6px;
}

.section--text .section__sentences {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  padding: var(--spacing-sm) var(--spacing-md);
}

.section--tip .section__sentences {
  background: #fef3c7;
}

.section--exercise .section__sentences {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  padding: var(--spacing-sm) var(--spacing-md);
}


/* --- Tongue twister: floating card design --- */
.section--tonguetwister {
  background: transparent;
  border-radius: 0;
  overflow: visible;
}

.section--tonguetwister .section__header {
  display: none;
}

.section--tonguetwister .section__content {
  border-radius: 0;
  padding: 0;
}

.section--tonguetwister .section__sentences {
  background: #fff;
  border-radius: 16px;
  padding: 20px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  gap: 0;
}

.section--tonguetwister .sentence {
  display: block;
  padding: 8px 0;
}

.section--tonguetwister .sentence__body {
  display: block;
}

.section--tonguetwister .sentence__text {
  display: block;
}

.section--matching .section__header {
  display: none;
}

.section--matching .section__sentences {
  background: transparent;
}

/* =============================================================================
   MATCHING EXERCISE
   ============================================================================= */

.matching {
  padding: var(--spacing-md);
}

.matching__instruction {
  margin: 0 0 var(--spacing-md) 0;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text-secondary);
  font-style: italic;
}

.matching__progress {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.matching__progress-text {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 600;
  color: var(--color-accent);
  min-width: 3em;
}

.matching__progress-bar {
  flex: 1;
  height: 6px;
  background: var(--color-border);
  border-radius: 3px;
  overflow: hidden;
}

.matching__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.matching__images {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

@media (max-width: 600px) {
  .matching__images {
    grid-template-columns: repeat(2, 1fr);
  }
}

.matching__image-card {
  position: relative;
  aspect-ratio: 1;
  padding: 0;
  border: 3px solid var(--color-border);
  border-radius: 12px;
  overflow: hidden;
  cursor: pointer;
  background: white;
  transition: all 0.2s ease;
}

.matching__image-card:hover:not(:disabled) {
  border-color: var(--color-accent);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.matching__image-card--selected {
  border-color: var(--color-accent);
  box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.3);
}

.matching__image-card--matched {
  border-color: #16a34a;
  opacity: 0.7;
  cursor: default;
}

.matching__image-card--matched:hover {
  transform: none;
  box-shadow: none;
}

.matching__image {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.matching__check {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 48px;
  height: 48px;
  background: #16a34a;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  font-weight: bold;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.matching__words {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
  justify-content: center;
}

.matching__word-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-md);
  background: white;
  border: 2px solid var(--color-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 80px;
}

.matching__word-card:hover:not(:disabled) {
  border-color: var(--color-accent);
  background: var(--color-accent-light);
}

.matching__word-card--matched {
  border-color: #16a34a;
  background: #dcfce7;
  opacity: 0.7;
  cursor: default;
}

.matching__word-card--matched:hover {
  background: #dcfce7;
}

.matching__word-card--wrong {
  animation: shake 0.5s ease;
  border-color: #dc2626;
  background: #fef2f2;
}

@keyframes shake {
  0%, 100% { transform: translateX(0); }
  20%, 60% { transform: translateX(-5px); }
  40%, 80% { transform: translateX(5px); }
}

.matching__word-pinyin {
  font-size: calc(12px * var(--font-scale, 1));
  color: var(--color-accent);
  font-style: italic;
}

.matching__word-text {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-family: var(--font-cjk);
  font-weight: 500;
  color: var(--color-text);
}

.matching__complete {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: #dcfce7;
  border: 2px solid #16a34a;
  border-radius: 8px;
  margin-top: var(--spacing-md);
  animation: fadeIn 0.3s ease;
}

.matching__complete-icon {
  font-size: 24px;
}

.matching__complete-text {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-weight: 600;
  color: #16a34a;
}

/* =============================================================================
   FILL-IN-THE-BLANK EXERCISE
   ============================================================================= */

.fillblank {
  padding: var(--spacing-md);
}

.fillblank__progress {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.fillblank__progress-text {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 600;
  color: var(--color-accent);
  min-width: 3em;
}

.fillblank__progress-bar {
  flex: 1;
  height: 6px;
  background: var(--color-border);
  border-radius: 3px;
  overflow: hidden;
}

.fillblank__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.fillblank__options {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  justify-content: center;
  margin-bottom: var(--spacing-lg);
  padding: var(--spacing-md);
  background: #f8fafc;
  border-radius: 8px;
  border: 1px solid var(--color-border);
}

.fillblank__option {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background: white;
  border: 2px solid var(--color-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  opacity: 0.6;
}

.fillblank__option--active {
  opacity: 1;
  cursor: pointer;
}

.fillblank__option--active:hover {
  border-color: var(--color-accent);
  background: var(--color-accent-light);
}

.fillblank__option:disabled {
  cursor: not-allowed;
}

.fillblank__option-label {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 700;
  color: #dc2626;
  min-width: 1.5em;
}

.fillblank__option-word {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-family: var(--font-cjk);
  font-weight: 500;
  color: var(--color-text);
}

.fillblank__sentences {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.fillblank__sentence {
  display: flex;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) 0;
  transition: background 0.2s ease;
}

.fillblank__sentence--correct {
  background: #f0fdf4;
  border-radius: 4px;
  padding: var(--spacing-sm);
  margin: 0 calc(-1 * var(--spacing-sm));
}

.fillblank__sentence--wrong {
  animation: shake 0.5s ease;
}

.fillblank__sentence-number {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  color: var(--color-text-secondary);
  min-width: 2.5em;
  flex-shrink: 0;
}

.fillblank__sentence-content {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-family: var(--font-cjk);
  line-height: 2;
  color: var(--color-text);
}

.fillblank__speaker {
  font-weight: 600;
  color: var(--color-accent);
  margin-right: var(--spacing-xs);
}

.fillblank__blank {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 4em;
  padding: 2px var(--spacing-sm);
  margin: 0 2px;
  background: #f1f5f9;
  border: 2px dashed var(--color-border);
  border-radius: 4px;
  cursor: pointer;
  font-family: var(--font-cjk);
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  color: var(--color-text-secondary);
  transition: all 0.2s ease;
  vertical-align: middle;
}

.fillblank__blank:hover:not(:disabled) {
  border-color: var(--color-accent);
  background: var(--color-accent-light);
}

.fillblank__blank--selected {
  border-color: var(--color-accent);
  border-style: solid;
  background: var(--color-accent-light);
  box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.2);
}

.fillblank__blank--correct {
  border-color: #16a34a;
  border-style: solid;
  background: #dcfce7;
  color: #16a34a;
  cursor: default;
}

.fillblank__blank--wrong {
  border-color: #dc2626;
  border-style: solid;
  background: #fef2f2;
  color: #dc2626;
}

.fillblank__complete {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: #dcfce7;
  border: 2px solid #16a34a;
  border-radius: 8px;
  margin-top: var(--spacing-md);
  animation: fadeIn 0.3s ease;
}

.fillblank__complete-icon {
  font-size: 24px;
}

.fillblank__complete-text {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-weight: 600;
  color: #16a34a;
}

.section--fillblank .section__sentences {
  background: transparent;
}

.section--multiplechoice .section__sentences {
  background: transparent;
}

/* =============================================================================
   MULTIPLE CHOICE EXERCISE
   ============================================================================= */

.mc {
  padding: var(--spacing-md);
}

.mc__progress {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.mc__progress-text {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 600;
  color: var(--color-accent);
  min-width: 3em;
}

.mc__progress-bar {
  flex: 1;
  height: 6px;
  background: var(--color-border);
  border-radius: 3px;
  overflow: hidden;
}

.mc__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.mc__questions {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.mc__question {
  transition: background 0.2s ease;
}

.mc__question--correct {
  background: #f0fdf4;
  border-radius: 8px;
  padding: var(--spacing-sm);
  margin: 0 calc(-1 * var(--spacing-sm));
}

.mc__question--wrong {
  animation: shake 0.5s ease;
}

.mc__sentence {
  display: flex;
  align-items: baseline;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-family: var(--font-cjk);
  line-height: 2;
}

.mc__number {
  color: var(--color-text-secondary);
  flex-shrink: 0;
}

.mc__text {
  color: var(--color-text);
}

.mc__blank {
  display: inline-block;
  min-width: 4em;
  padding: 2px var(--spacing-sm);
  margin: 0 2px;
  background: #f1f5f9;
  border: 2px dashed var(--color-border);
  border-radius: 4px;
  text-align: center;
  font-family: var(--font-cjk);
  color: var(--color-text-secondary);
  vertical-align: middle;
}

.mc__blank--correct {
  border-color: #16a34a;
  border-style: solid;
  background: #dcfce7;
  color: #16a34a;
}

.mc__blank--wrong {
  border-color: #dc2626;
  border-style: solid;
  background: #fef2f2;
  color: #dc2626;
}

.mc__options {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-md);
  padding-left: 2.5em;
}

.mc__option {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm) var(--spacing-md);
  background: white;
  border: 2px solid var(--color-border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 80px;
}

.mc__option:hover:not(:disabled) {
  border-color: var(--color-accent);
  background: var(--color-accent-light);
}

.mc__option--correct {
  border-color: #16a34a;
  background: #dcfce7;
}

.mc__option--correct:hover {
  background: #dcfce7;
}

.mc__option--wrong {
  border-color: #dc2626;
  background: #fef2f2;
}

.mc__option-label {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 700;
  color: #dc2626;
  min-width: 1.2em;
}

.mc__option-content {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
}

.mc__option-pinyin {
  font-size: calc(12px * var(--font-scale, 1));
  color: var(--color-accent);
  font-style: italic;
}

.mc__option-word {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-family: var(--font-cjk);
  font-weight: 500;
  color: var(--color-text);
}

.mc__complete {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-md);
  background: #dcfce7;
  border: 2px solid #16a34a;
  border-radius: 8px;
  margin-top: var(--spacing-md);
  animation: fadeIn 0.3s ease;
}

.mc__complete-icon {
  font-size: 24px;
}

.mc__complete-text {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-weight: 600;
  color: #16a34a;
}

/* =========================================================================
   IMAGE DESCRIBE EXERCISE
   ========================================================================= */

.section--imagedescribe .section__sentences {
  background: transparent;
}

.imgdesc {
  padding: var(--spacing-md) 0;
}

.imgdesc__progress {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.imgdesc__progress-text {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 600;
  color: var(--color-accent);
  min-width: 2.5em;
}

.imgdesc__progress-bar {
  flex: 1;
  height: 6px;
  background: var(--color-border);
  border-radius: 3px;
  overflow: hidden;
}

.imgdesc__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 3px;
  transition: width 0.3s ease;
}

.imgdesc__grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-lg);
}

@media (max-width: 600px) {
  .imgdesc__grid {
    grid-template-columns: 1fr;
  }
}

.imgdesc__card {
  border: 2px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  background: white;
}

.imgdesc__image {
  width: 100%;
  aspect-ratio: 4/3;
  overflow: hidden;
  background: #f3f4f6;
}

.imgdesc__image-img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.imgdesc__sentence {
  padding: var(--spacing-md);
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  line-height: 2;
  display: flex;
  flex-wrap: wrap;
  align-items: center;
}

/* Dialogue layout for imagedescribe exercise */
.imgdesc__sentence--dialogue {
  display: grid;
  grid-template-columns: 2.5em auto 1fr;
  gap: var(--spacing-xs);
  align-items: start;
}

.imgdesc__sentence--dialogue .sentence__dialogue-number {
  font-weight: normal;
  color: var(--color-text-primary);
  text-align: center;
}

.imgdesc__sentence--dialogue .sentence__speaker {
  font-weight: 500;
  color: var(--color-accent);
  min-width: 3em;
}

.imgdesc__sentence--dialogue .imgdesc__text-content {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  gap: 4px;
}

.imgdesc__blank-wrapper {
  display: inline-flex;
  align-items: center;
  gap: 2px;
  position: relative;
}

.imgdesc__blank-wrapper--wrong {
  animation: imgdesc-shake 0.4s ease-in-out;
}

@keyframes imgdesc-shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-4px); }
  40% { transform: translateX(4px); }
  60% { transform: translateX(-3px); }
  80% { transform: translateX(3px); }
}

.imgdesc__input {
  border: none;
  border-bottom: 2px solid var(--color-border);
  background: transparent;
  font-size: inherit;
  font-family: inherit;
  width: 5em;
  text-align: center;
  padding: 0 var(--spacing-xs);
  outline: none;
  transition: border-color 0.2s;
}

.imgdesc__input:focus {
  border-bottom-color: var(--color-accent);
}

.imgdesc__input--correct {
  border-bottom-color: #16a34a;
  color: #16a34a;
  font-weight: 600;
}

.imgdesc__input--wrong {
  border-bottom-color: #dc2626;
  color: #dc2626;
}

.imgdesc__input::placeholder {
  color: var(--color-text-light);
  font-weight: 400;
}

.imgdesc__check-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.5em;
  height: 1.5em;
  border: none;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 700;
  cursor: pointer;
  padding: 0;
  flex-shrink: 0;
}

.imgdesc__check-btn:hover {
  background: #2563eb;
}

.imgdesc__complete {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
  padding: var(--spacing-lg);
  margin-top: var(--spacing-lg);
  background: #f0fdf4;
  border-radius: 8px;
}

.imgdesc__complete-icon {
  font-size: 1.5em;
}

.imgdesc__complete-text {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-weight: 600;
  color: #16a34a;
}

/* =========================================================================
   TABLE FILL EXERCISE (课堂活动 - 填写表格)
   ========================================================================= */

.section--activity .section__sentences {
  background: transparent;
}

.tablefill {
  padding: var(--spacing-md);
}

.tablefill__table {
  border: 2px solid var(--color-border);
  border-radius: 8px;
  overflow: hidden;
  margin-top: var(--spacing-lg);
}

.tablefill__row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(0, 1fr));
}

.tablefill__row--header {
  background: #f0fdf4;
  border-bottom: 2px solid var(--color-border);
}

.tablefill__cell {
  padding: var(--spacing-md);
  text-align: center;
  border: none;
  background: none;
  font-family: inherit;
}

.tablefill__cell + .tablefill__cell {
  border-left: 1px solid var(--color-border);
}

.tablefill__cell--header {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 2px;
}

.tablefill__cell-label {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  font-weight: 600;
}

.tablefill__cell-pinyin {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-accent);
  font-style: italic;
}

.tablefill__cell--input {
  min-height: 3em;
  cursor: pointer;
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  transition: background 0.2s, box-shadow 0.2s;
}

.tablefill__cell--input:hover {
  background: #f9fafb;
}

.tablefill__cell--selected {
  background: #eff6ff;
  box-shadow: inset 0 0 0 2px var(--color-accent);
}

.tablefill__cell--filled {
  color: #16a34a;
  font-weight: 600;
}

/* =========================================================================
   BONUS CONTENT (小语的彩蛋)
   ========================================================================= */

.section--bonus {
  margin-top: var(--spacing-xl);
}

.section--bonus .section__header {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  border-radius: 12px 12px 0 0;
}

.section--bonus .section__sentences {
  background: transparent;
  padding: 0;
}

.bonus__video-wrapper {
  border-radius: 0 0 12px 12px;
  overflow: hidden;
  background: #1a1a1a;
  border: 2px solid var(--color-border);
  border-top: none;
}

.bonus__video {
  width: 100%;
  display: block;
  max-height: 400px;
  object-fit: contain;
  background: #1a1a1a;
}

/* Section header with subheading - styled like textbook */
.section__header {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-md);
  margin-bottom: 0;
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  padding: var(--spacing-sm) var(--spacing-lg);
  border-radius: 8px 8px 0 0;
  position: relative;
}

.section__heading {
  margin: 0;
  font-size: calc(var(--font-size-large) * var(--font-scale, 1));
  font-weight: 700;
  color: white;
  font-family: var(--font-cjk);
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.section__subheading {
  font-size: calc(var(--font-size-base) * var(--font-scale, 1));
  color: rgba(255, 255, 255, 0.9);
  font-weight: 500;
  padding-left: var(--spacing-sm);
  border-left: 2px solid rgba(255, 255, 255, 0.4);
}

/* Section audio button (play all) */
.section__audio-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  padding: 0;
  border: none;
  border-radius: 50%;
  background: var(--color-accent);
  color: white;
  cursor: pointer;
  transition: all 0.15s ease;
  flex-shrink: 0;
}

.section__audio-btn:hover {
  background: #2563eb;
  transform: scale(1.05);
}

.section__audio-btn:disabled {
  cursor: wait;
}

.section__audio-btn--playing {
  background: #16a34a;
}

.section__audio-loading {
  width: 14px;
  height: 14px;
  border: 2px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

/* Floating audio FAB (appears when section play button is scrolled out of view) */
.page__audio-fab {
  position: fixed;
  bottom: 80px;
  right: 24px;
  width: 48px;
  height: 48px;
  border: none;
  border-radius: 50%;
  background: var(--color-accent, #3182ce);
  color: white;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  transition: background-color 0.2s ease, transform 0.15s ease;
  z-index: 80;
}

.page__audio-fab:hover {
  transform: scale(1.08);
}

.page__audio-fab--playing {
  background: #16a34a;
}

.page__audio-fab:disabled {
  opacity: 0.7;
  cursor: not-allowed;
}

.page__audio-fab-spinner {
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Section context (scene description) */
.section__context {
  margin-bottom: var(--spacing-md);
  padding: var(--spacing-sm) var(--spacing-md);
  background: rgba(0, 0, 0, 0.03);
  border-radius: 4px;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
}

.section__context-text {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--color-text);
  font-family: var(--font-cjk);
}

.section__context-pinyin {
  margin: 0 0 var(--spacing-xs) 0;
  color: var(--color-accent);
  font-style: italic;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
}

.section__context-translation {
  margin: 0;
  color: var(--color-text-secondary);
  font-style: italic;
}

/* Section instruction row with play button */
.section__instruction-row {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  margin-top: var(--spacing-sm);
  margin-bottom: var(--spacing-md);
}

.section__instruction-checkbox {
  color: var(--color-accent);
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  flex-shrink: 0;
  line-height: 1.6;
  margin-top: 0.1em;
}

/* Exercise instruction alignment with card content */
.section--exercise .section__instruction-row {
  padding-left: var(--spacing-md);
}

.section__instruction {
  margin: 0;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text-secondary);
  font-style: italic;
}

/* Section tip box (小语助力) */
.section__tip {
  margin-bottom: var(--spacing-md);
  padding: 18px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
  position: relative;
}

.section__tip-label {
  display: inline-block;
  padding: 2px 8px;
  background: #f59e0b;
  color: white;
  font-size: calc(12px * var(--font-scale, 1));
  font-weight: 600;
  border-radius: 4px;
  margin-bottom: var(--spacing-xs);
}

.section__tip-text {
  margin: var(--spacing-xs) 0 0 0;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text);
  font-family: var(--font-cjk);
}

.section__tip-pinyin {
  margin: var(--spacing-xs) 0 0 0;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-accent);
  font-style: italic;
}

.section__tip-translation {
  margin: var(--spacing-xs) 0 0 0;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text-secondary);
  font-style: italic;
}

/* Section content container */
.section__content {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* Image above dialogue layout */
.section__content--with-image {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

/* Section image (original textbook scan) */
.section__image {
  max-width: 100%;
}

.section__image-img {
  display: block;
  width: 100%;
  height: auto;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1), 0 6px 24px rgba(0, 0, 0, 0.06);
}



/* Multiple bottom images grid */
.section__images-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-md);
  padding: var(--spacing-md) var(--spacing-lg);
}

.section__images-grid-item {
  border-radius: 8px;
  overflow: hidden;
}

.section__images-grid-img {
  display: block;
  width: 100%;
  height: auto;
}

/* =============================================================================
   SENTENCE
   ============================================================================= */

.sentence {
  display: grid;
  grid-template-columns: auto 1fr;
  gap: var(--spacing-sm);
  padding: var(--spacing-sm);
  border-radius: 4px;
  transition: background-color 0.15s ease, color 0.15s ease;
  align-items: start;
  cursor: pointer;
}

/* Sentences without speaker span full width */
.sentence:not(:has(.sentence__speaker)) {
  grid-template-columns: 1fr;
}


.sentence--active {
  color: var(--color-accent);
}

.sentence--has-audio {
  cursor: pointer;
}

.sentence--playing .sentence__text {
  color: var(--color-accent);
}

.sentence__speaker {
  min-width: 3em;
  font-weight: 600;
  color: var(--color-accent);
  white-space: nowrap;
}

.sentence__body {
  display: inline-flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
  cursor: pointer;
  font-family: var(--font-cjk);
}

.sentence__body:focus {
  outline: none;
}

.sentence__text {
  flex: 1;
}

.sentence__audio-btn {
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-top: 6px;
  width: 32px;
  height: 32px;
  padding: 0;
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  cursor: pointer;
  color: var(--color-text-secondary);
  transition: all 0.15s ease;
}

.sentence__audio-btn svg {
  width: 16px;
  height: 16px;
}

.sentence__audio-btn:hover {
  background: var(--color-accent-light);
  border-color: var(--color-accent);
  color: var(--color-accent);
}

.sentence__audio-btn:focus {
  outline: none;
}

.sentence__audio-btn--playing {
  background: var(--color-accent);
  border-color: var(--color-accent);
  color: white;
}

.sentence__audio-btn--loading {
  opacity: 0.6;
  cursor: wait;
}

.sentence__audio-btn:disabled {
  cursor: not-allowed;
}

/* Sentence checkbox for objectives */
.sentence__checkbox {
  display: inline-block;
  margin-right: var(--spacing-sm);
  font-size: 1.2em;
  color: #dc2626;
  vertical-align: middle;
}

/* Grammar number badge */
.sentence__grammar-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 1.5em;
  height: 1.5em;
  background: #dc2626;
  color: white;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 700;
  border-radius: 4px;
  margin-right: var(--spacing-sm);
  flex-shrink: 0;
}

/* Align grammar number badge with the first line (Chinese text) */
.sentence__grammar-number {
  margin-top: 0.15em;
}

/* Sentence text block (Chinese + pinyin) */
.sentence__text-block {
  display: flex;
  flex-direction: column;
}

/* First line: Chinese text + audio button inline */
.sentence__text-row {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-sm);
}

/* Character-aligned pinyin below text (ruby) */
.sentence__text ruby {
  ruby-position: under;
  margin: 0 0.1em;
}

.sentence__text rt {
  font-family: var(--font-pinyin);
  font-size: 0.6em;
  color: var(--color-accent);
  font-style: normal;
  font-weight: normal;
  padding-top: 0.3em;
}

.sentence__text rp {
  display: none;
}

/* Sentence pinyin (below the text) — legacy */
.sentence__pinyin {
  display: block;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-accent);
  font-style: italic;
  margin-top: var(--spacing-xs);
  font-family: var(--font-pinyin);
  letter-spacing: 0.5px;
}

/* Sentence translation inline (below pinyin) */
.sentence__translation-inline {
  display: block;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  color: var(--color-text-translation);
  margin-top: var(--spacing-xs);
  font-family: var(--font-main);
  font-style: italic;
}

.sentence__translation {
  margin-top: var(--spacing-sm);
  padding: var(--spacing-sm);
  background: var(--color-accent-light);
  border-radius: 4px;
  color: var(--color-text-translation);
  font-size: var(--font-size-small);
  font-family: var(--font-main);
}

/* =============================================================================
   WORD
   ============================================================================= */

.word {
  /* Base word styling */
}


/* =============================================================================
   RESPONSIVE
   ============================================================================= */

@media (max-width: 600px) {
  :root {
    --font-size-base: 16px;
    --font-size-large: 20px;
    --spacing-lg: 16px;
    --spacing-xl: 24px;
    --header-height: 52px;
    --bottom-nav-height: 48px;
  }

  .page {
    padding: var(--spacing-md);
    padding-top: calc(var(--header-height) + 1em + var(--spacing-md) + env(safe-area-inset-top, 0px));
    padding-bottom: calc(var(--bottom-nav-height) + 1em + var(--spacing-md) + env(safe-area-inset-bottom, 0px));
  }
}

/* =============================================================================
   STORY READER
   ============================================================================= */

.story {
  max-width: 900px;
  margin: 0 auto;
  padding: calc(var(--header-height, 60px) + 3em + env(safe-area-inset-top, 0px)) var(--spacing-xl) calc(56px + env(safe-area-inset-bottom, 0px));
}

.story--with-audio {
  padding-bottom: calc(168px + env(safe-area-inset-bottom, 0px));
}

@media (max-width: 600px) {
  .story {
    padding-left: var(--spacing-md);
    padding-right: var(--spacing-md);
  }
}

.story__paragraph {
  margin-bottom: 0;
}

.story__paragraph--dialogue {
  display: flex;
  flex-direction: column;
  gap: 0.5em;
}

.story__dialogue-line {
  display: flex;
  align-items: flex-start;
  cursor: pointer;
  font-size: 1.2em;
  font-family: var(--font-cjk);
  line-height: 2.8;
}

.story__speaker {
  flex-shrink: 0;
  font-weight: 700;
  min-width: 2.5em;
  color: var(--color-accent);
}

.story__speaker::after {
  content: "：";
}

.story__dialogue-text {
  flex: 1;
}

.story__dialogue-text ruby {
  ruby-position: over;
  margin: 0 0.15em;
}

.story__dialogue-text rt {
  font-family: var(--font-pinyin);
  color: var(--color-accent);
  padding-bottom: 0.15em;
}

.story__dialogue-line.story__sentence--active .story__dialogue-text,
.story__dialogue-line.story__sentence--playing .story__dialogue-text {
  color: var(--color-accent);
}

.story__text {
  font-size: 1.2em;
  font-family: var(--font-cjk);
  color: var(--color-text);
  margin: 0;
  line-height: 2.8;
}

.story__text ruby {
  ruby-position: over;
  margin: 0 0.15em;
}

.story__text rt {
  font-family: var(--font-pinyin);
  font-size: 0.5em;
  color: var(--color-accent);
  font-weight: normal;
  padding-bottom: 0.15em;
}

.story__text rp {
  display: none;
}

.story__sentence {
  cursor: pointer;
}

.story__sentence--active,
.story__sentence--playing {
  color: var(--color-accent, #4a90e2);
}

/* Word-level press-and-hold */
.story__word {
  border-radius: 2px;
  transition: background 0.15s;
  -webkit-user-select: none;
  user-select: none;
  -webkit-touch-callout: none;
}

.story__word--active {
  background: rgba(49, 130, 206, 0.15);
}

.story__translation-panel {
  position: fixed;
  top: calc(var(--header-height, 60px) + env(safe-area-inset-top, 0px));
  left: 0;
  right: 0;
  z-index: 99;
  background: var(--color-surface, #fff);
  border-bottom: 1px solid var(--color-border, #e0e0e0);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
  padding: var(--spacing-sm) var(--spacing-xl);
}

.story__translation-panel-text {
  margin: 0;
  font-size: 1.15em;
  color: var(--color-text-secondary);
  font-style: italic;
  text-align: center;
  line-height: 1.5;
}

.story__word-hsk {
  display: inline-block;
  margin-left: 0.5em;
  padding: 0.1em 0.4em;
  font-size: 0.75em;
  font-style: normal;
  font-weight: 600;
  color: var(--color-accent, #3182ce);
  border: 1px solid var(--color-accent, #3182ce);
  border-radius: 4px;
  vertical-align: middle;
}

.story__play-fab {
  position: fixed;
  bottom: calc(72px + env(safe-area-inset-bottom, 0px));
  right: 32px;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  background: var(--color-accent, #4a90e2);
  color: white;
  font-size: 1.25rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
  transition: background-color 0.2s ease, transform 0.15s ease;
  z-index: 80;
}

.story__play-fab:hover {
  transform: scale(1.08);
}

.story__play-fab:active {
  transform: scale(0.95);
}

.story__play-fab--playing {
  background: var(--color-primary, #dc2626);
}

.story__play-fab-icon {
  display: block;
  margin-left: 2px;
}

.story__play-fab-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Audio bar — expanded player */
.story__audio-bar {
  position: fixed;
  bottom: calc(48px + env(safe-area-inset-bottom, 0px));
  left: 0;
  right: 0;
  z-index: 80;
  background: rgba(255, 255, 255, 0.97);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top: 1px solid var(--color-border, #e0e0e0);
  box-shadow: 0 -2px 12px rgba(0, 0, 0, 0.1);
  padding: 12px 24px 12px;
}

.story__audio-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 20px;
  margin-bottom: 8px;
}

.story__audio-play {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: var(--color-accent, #4a90e2);
  color: white;
  font-size: 1.2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.15s ease;
}

.story__audio-play:active {
  transform: scale(0.92);
}

.story__audio-skip {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 1px solid var(--color-border, #ddd);
  background: transparent;
  color: var(--color-text, #333);
  font-size: 0.75rem;
  font-weight: 600;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.15s ease;
}

.story__audio-skip:active {
  background: var(--color-border, #eee);
}

.story__audio-progress-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.story__audio-time {
  font-size: 0.75rem;
  color: var(--color-text-secondary, #888);
  min-width: 32px;
  text-align: center;
  font-variant-numeric: tabular-nums;
}

.story__audio-progress {
  flex: 1;
  height: 4px;
  background: var(--color-border, #e0e0e0);
  border-radius: 2px;
  cursor: pointer;
  position: relative;
}

.story__audio-progress-fill {
  height: 100%;
  background: var(--color-accent, #4a90e2);
  border-radius: 2px;
  transition: width 0.1s linear;
}

/* Story bottom toggle bar */
.story__bottom-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 90;
  background: rgba(245, 245, 245, 0.97);
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  border-top: 1px solid var(--color-border, #e0e0e0);
  padding: 8px 24px calc(8px + env(safe-area-inset-bottom, 0px));
}

.story__bottom-bar-inner {
  display: flex;
  justify-content: center;
  gap: 8px;
}

/* Focus Mode */
.story--focus {
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: calc(100vh - var(--header-height, 60px) - 120px);
}

.story__focus {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xl, 32px);
  width: 100%;
}

.story__focus-text {
  text-align: center;
  font-size: 1.5em;
  line-height: 3;
  min-height: 9em; /* 3 lines × line-height 3 — keeps nav stable */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.story__focus-speaker {
  font-weight: 700;
  color: var(--color-accent);
  font-size: 0.75em;
  line-height: 1.5;
}

.story__focus-nav {
  display: flex;
  align-items: center;
  gap: var(--spacing-md, 16px);
}

.story__focus-nav-btn {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  border: none;
  background: #f0f0f0;
  color: #333;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s;
}

.story__focus-nav-btn:active:not(:disabled) {
  background: #e0e0e0;
}

.story__focus-nav-btn:disabled {
  opacity: 0.25;
  cursor: default;
}

.story__focus-play-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: var(--color-accent, #4a90e2);
  color: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s;
}

.story__focus-play-btn:active {
  background: #3a7bd5;
}

.story__focus-counter {
  font-size: 0.85em;
  color: var(--color-text-secondary, #666);
  text-align: center;
}


/* =============================================================================
   FLASHCARD
   ============================================================================= */

.flashcard-page {
  width: 100%;
  min-height: 100vh;
  max-width: 900px;
  margin: 0 auto;
  padding: var(--spacing-lg) var(--spacing-xl);
  padding-top: calc(56px + var(--spacing-lg) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(48px + var(--spacing-lg) + env(safe-area-inset-bottom, 0px));
}

@media (min-width: 1200px) {
  .flashcard-page { max-width: 1000px; }
}

@media (min-width: 1600px) {
  .flashcard-page { max-width: 1100px; }
}

.flashcard-page__logo-header {
  padding: var(--spacing-md) 0;
}

/* Header */
.flashcard-page__header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-lg);
  gap: var(--spacing-md);
}

.flashcard-page__back {
  color: var(--color-accent);
  text-decoration: none;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  flex-shrink: 0;
}

.flashcard-page__back:hover {
  text-decoration: underline;
}

.flashcard-page__title {
  margin: 0;
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--color-text);
  flex: 1;
  text-align: center;
}

.flashcard-page__controls {
  display: flex;
  align-items: center;
  gap: var(--spacing-xs);
  flex-shrink: 0;
}

.flashcard-page__toggle {
  width: 36px;
  height: 36px;
  border: 2px solid var(--color-border);
  border-radius: 8px;
  background: white;
  color: var(--color-text-secondary);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.flashcard-page__toggle--active {
  border-color: var(--color-accent);
  color: var(--color-accent);
  background: #ebf8ff;
}

.flashcard-page__toggle:hover {
  border-color: var(--color-accent);
}

.flashcard-page__toggle--dir {
  width: auto;
  padding: 0 10px;
  font-size: 0.75rem;
  white-space: nowrap;
}

/* Progress bar */
.flashcard__progress {
  display: flex;
  align-items: center;
  gap: var(--spacing-sm);
  margin-bottom: var(--spacing-lg);
}

.flashcard__progress-text {
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
  font-weight: 600;
  color: var(--color-accent);
  min-width: 3em;
}

.flashcard__progress-bar {
  flex: 1;
  height: 6px;
  background: var(--color-border);
  border-radius: 3px;
  overflow: hidden;
}

.flashcard__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 3px;
  transition: width 0.3s ease;
}

/* Card container with perspective for 3D flip */
.flashcard__card-container {
  perspective: 1000px;
  margin: 0 auto var(--spacing-lg);
  max-width: 400px;
  width: 100%;
}

.flashcard__card {
  position: relative;
  width: 100%;
  aspect-ratio: 3 / 4;
  cursor: pointer;
  transform-style: preserve-3d;
  transition: transform 0.5s ease;
}

.flashcard__card--flipped {
  transform: rotateY(180deg);
}

/* Shared face styles */
.flashcard__face {
  position: absolute;
  inset: 0;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: var(--spacing-xl);
  border-radius: 16px;
  border: 2px solid var(--color-border);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
}

/* Front face */
.flashcard__face--front {
  background: white;
  justify-content: space-between;
}

/* Groups Chinese + audio + pinyin in the center of the face */
.flashcard__front-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
}

.flashcard__chinese {
  font-size: 3rem;
  font-weight: 700;
  color: var(--color-text);
  text-align: center;
  line-height: 1.4;
}

/* Audio button on flashcard front */
.flashcard__audio-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid var(--color-accent);
  background: transparent;
  color: var(--color-accent);
  cursor: pointer;
  transition: background 0.2s ease, color 0.2s ease;
}

.flashcard__audio-btn:hover {
  background: var(--color-accent);
  color: white;
}

.flashcard__audio-btn--playing {
  background: var(--color-accent);
  color: white;
}

.flashcard__audio-btn--loading {
  opacity: 0.6;
  cursor: wait;
}

.flashcard__audio-fab {
  position: fixed;
  bottom: calc(56px + env(safe-area-inset-bottom, 0px));
  right: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  background: var(--color-accent, #4a90e2);
  color: white;
  font-size: 1.25rem;
  cursor: pointer;
  transition: background-color 0.2s ease, transform 0.15s ease;
  z-index: 80;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}

.flashcard__audio-fab:hover {
  transform: scale(1.08);
}

.flashcard__audio-fab:active {
  transform: scale(0.95);
}

.flashcard__audio-fab--playing {
  background: var(--color-primary, #dc2626);
}

.flashcard__audio-fab--loading {
  opacity: 0.6;
  cursor: wait;
}

.flashcard__audio-fab-icon {
  display: block;
  margin-left: 2px;
}

.flashcard__audio-fab-spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.flashcard__pinyin {
  font-size: 1.25rem;
  color: var(--color-accent);
  font-style: italic;
  text-align: center;
}

.flashcard__tap-hint {
  font-size: var(--font-size-small);
  color: var(--color-text-secondary);
  opacity: 0.6;
  padding-bottom: var(--spacing-sm);
}

/* Back face */
.flashcard__face--back {
  background: #f0fdf4;
  transform: rotateY(180deg);
}

.flashcard__translation {
  font-size: 1.85rem;
  font-weight: 600;
  color: var(--color-text);
  text-align: center;
  line-height: 1.6;
}

.flashcard__back-chinese {
  font-size: 1.25rem;
  color: var(--color-text-secondary);
  margin-top: var(--spacing-md);
}

.flashcard__back-pinyin {
  font-size: var(--font-size-small);
  color: var(--color-accent);
  font-style: italic;
  margin-top: var(--spacing-xs);
}

.flashcard__back-translation {
  font-size: 1rem;
  color: var(--color-text-secondary);
  font-style: italic;
  margin-top: var(--spacing-sm);
}

/* Action buttons */
.flashcard__actions {
  display: flex;
  gap: var(--spacing-md);
  justify-content: center;
  margin-bottom: var(--spacing-lg);
  transition: opacity 0.2s ease;
}

.flashcard__actions--hidden {
  opacity: 0;
  pointer-events: none;
}

.flashcard__action-btn {
  flex: 1;
  max-width: 180px;
  padding: var(--spacing-md) var(--spacing-lg);
  border: 2px solid;
  border-radius: 12px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.flashcard__action-btn--know {
  background: #dcfce7;
  border-color: #16a34a;
  color: #16a34a;
}

.flashcard__action-btn--know:hover {
  background: #16a34a;
  color: white;
}

.flashcard__action-btn--unknown {
  background: #fef2f2;
  border-color: #dc2626;
  color: #dc2626;
}

.flashcard__action-btn--unknown:hover {
  background: #dc2626;
  color: white;
}

/* Completion screen */
.flashcard__complete {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-xl);
  background: #dcfce7;
  border: 2px solid #16a34a;
  border-radius: 12px;
  animation: fadeIn 0.3s ease;
  text-align: center;
}

.flashcard__complete-text {
  font-size: 1.25rem;
  font-weight: 600;
  color: #16a34a;
}

.flashcard__stats {
  display: flex;
  gap: var(--spacing-xl);
  margin-top: var(--spacing-md);
}

.flashcard__stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: var(--spacing-xs);
}

.flashcard__stat-value {
  font-size: 2rem;
  font-weight: 700;
}

.flashcard__stat-value--known { color: #16a34a; }
.flashcard__stat-value--unknown { color: #dc2626; }

.flashcard__stat-label {
  font-size: var(--font-size-small);
  color: var(--color-text-secondary);
}

.flashcard__restart-btns {
  display: flex;
  gap: var(--spacing-md);
  margin-top: var(--spacing-md);
  flex-wrap: wrap;
  justify-content: center;
}

.flashcard__restart-btn {
  padding: var(--spacing-sm) var(--spacing-lg);
  border: 2px solid var(--color-accent);
  border-radius: 8px;
  background: white;
  color: var(--color-accent);
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: calc(var(--font-size-small) * var(--font-scale, 1));
}

.flashcard__restart-btn:hover {
  background: var(--color-accent);
  color: white;
}

/* Mobile responsive */
@media (max-width: 600px) {
  .flashcard-page {
    padding: var(--spacing-md);
    padding-top: calc(56px + var(--spacing-md) + env(safe-area-inset-top, 0px));
    padding-bottom: calc(48px + var(--spacing-md) + env(safe-area-inset-bottom, 0px));
  }

  .flashcard-page__title {
    font-size: 1.2rem;
  }

  .flashcard__chinese {
    font-size: 2.5rem;
  }

  .flashcard__card-container {
    max-width: 320px;
  }

  .flashcard__action-btn {
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: 0.9rem;
  }
}

/* =============================================================================
   KARAOKE PLAYER
   ============================================================================= */

.karaoke {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: #0a0a0a;
  color: #fff;
}

.karaoke__info {
  text-align: center;
  padding: calc(var(--header-height) + 40px + env(safe-area-inset-top, 0px)) var(--spacing-xl) var(--spacing-lg);
}

.karaoke__title {
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 4px;
  color: #fff;
}

.karaoke__pinyin {
  font-size: 1rem;
  color: rgba(255, 255, 255, 0.5);
  font-style: italic;
  margin: 0 0 8px;
}

.karaoke__artist {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.4);
  margin: 0 0 4px;
}

.karaoke__translation {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.35);
  font-style: italic;
  margin: 0;
}

/* Lyrics container */
.karaoke__lyrics {
  flex: 1;
  overflow-y: auto;
  padding: calc(var(--header-height) + 60px + env(safe-area-inset-top, 0px)) var(--spacing-xl);
  display: flex;
  flex-direction: column;
  gap: 20px;
  padding-bottom: 200px;
}

.karaoke__line {
  font-size: 1.8em;
  font-weight: 500;
  text-align: center;
  color: rgba(255, 255, 255, 0.25);
  line-height: 2;
  cursor: pointer;
}

.karaoke__line--active {
  color: rgba(255, 255, 255, 0.5);
}

.karaoke__line--past {
  color: rgba(255, 255, 255, 0.15);
}

/* Ruby pinyin */
.karaoke__char {
  margin: 0 0.08em;
}

.karaoke__rt {
  font-family: var(--font-pinyin);
  font-size: 0.5em;
  color: rgba(255, 255, 255, 0.35);
  font-weight: 400;
  padding-bottom: 0.15em;
}

.karaoke__rt--hidden {
  visibility: hidden;
}

.karaoke__line--active .karaoke__rt {
  color: rgba(255, 255, 255, 0.5);
}

/* Character highlighting */
.karaoke__char--sung {
  color: #4fc3f7;
}

.karaoke__char--sung .karaoke__rt {
  color: #4fc3f7;
}

.karaoke__char--singing {
  color: #ffd54f;
}

.karaoke__char--singing .karaoke__rt {
  color: #4fc3f7;
}

/* Controls at bottom — sits above the bottom bar */
.karaoke__controls {
  position: fixed;
  bottom: calc(44px + env(safe-area-inset-bottom, 0px));
  left: 0;
  right: 0;
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding: 4px var(--spacing-xl) 16px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  z-index: 91;
}

.karaoke__controls::after {
  content: '';
  position: absolute;
  bottom: 3px;
  left: 0;
  right: 0;
  height: 1px;
  background: rgba(255, 255, 255, 0.1);
}

/* Dark bottom bar for karaoke */
.karaoke .story__bottom-bar {
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-top: none;
}

.karaoke .reader__nav-toggle {
  color: rgba(255, 255, 255, 0.5);
  background: rgba(255, 255, 255, 0.1);
}

.karaoke .reader__nav-toggle--active {
  background: #4fc3f7;
  color: #fff;
}

/* Dark translation panel for karaoke */
.karaoke .story__translation-panel {
  background: rgba(10, 10, 10, 0.95);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
}

.karaoke .story__translation-panel-text {
  color: rgba(255, 255, 255, 0.7);
}

/* Dark header controls for karaoke */
.karaoke .reader__home-logo {
  filter: brightness(0) invert(1);
}

.karaoke .reader__header {
  background: rgba(10, 10, 10, 0.95);
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.karaoke .page__lang-btn {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  color: rgba(255, 255, 255, 0.7);
}

.karaoke .page__lang-btn:hover {
  background: rgba(255, 255, 255, 0.15);
}

.karaoke .page__font-controls {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.karaoke .page__font-btn {
  color: rgba(255, 255, 255, 0.6);
}

.karaoke .page__font-btn:hover:not(:disabled) {
  background: rgba(255, 255, 255, 0.15);
  color: rgba(255, 255, 255, 0.9);
}

/* Progress bar */
.karaoke__progress {
  width: 100%;
  max-width: 500px;
  height: 4px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 2px;
  cursor: pointer;
  overflow: hidden;
  margin-top: 20px;
}

.karaoke__progress-bar {
  height: 100%;
  background: #4fc3f7;
  border-radius: 2px;
  transition: width 0.1s linear;
}

.karaoke__time {
  width: 100%;
  max-width: 500px;
  display: flex;
  justify-content: space-between;
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.4);
}

/* Playback row */
.karaoke__playback-row {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 24px;
}

.karaoke__skip-btn {
  position: relative;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: transparent;
  color: rgba(255, 255, 255, 0.6);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
}

.karaoke__skip-btn:active {
  color: rgba(255, 255, 255, 0.9);
}

.karaoke__skip-label {
  position: absolute;
  font-size: 8px;
  font-weight: 700;
  color: inherit;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  margin-top: 1px;
}

/* Play button */
.karaoke__play-btn {
  width: 56px;
  height: 56px;
  border-radius: 50%;
  border: none;
  background: #4fc3f7;
  color: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.15s, transform 0.1s;
}

.karaoke__play-btn:hover {
  background: #29b6f6;
}

.karaoke__play-btn:active {
  transform: scale(0.95);
}

.karaoke__play-btn--loading {
  opacity: 0.6;
  cursor: wait;
}

.karaoke__spinner {
  width: 24px;
  height: 24px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Mobile */
@media (max-width: 600px) {
  .karaoke__info {
    padding-left: var(--spacing-md);
    padding-right: var(--spacing-md);
  }

  .karaoke__title {
    font-size: 1.5rem;
  }

  .karaoke__lyrics {
    padding: calc(var(--header-height) + 60px + env(safe-area-inset-top, 0px)) var(--spacing-md);
    padding-bottom: 200px;
    gap: 16px;
  }

  .karaoke__line {
    font-size: 1.4em;
  }

  .karaoke__controls {
    padding: 4px var(--spacing-md) 16px;
  }
}

/* =============================================================================
   ACCESSIBILITY
   ============================================================================= */

@media (prefers-reduced-motion: reduce) {
  * {
    transition: none !important;
  }
}

/* High contrast mode */
@media (prefers-contrast: high) {
  :root {
    --color-border: #000;
    --color-text-secondary: #000;
  }
}

/* =============================================================================
   ERROR STATES
   ============================================================================= */

.page__audio-error {
  position: fixed;
  bottom: var(--spacing-md);
  left: 50%;
  transform: translateX(-50%);
  padding: var(--spacing-sm) var(--spacing-md);
  background: #fee2e2;
  color: #991b1b;
  border: 1px solid #fecaca;
  border-radius: 6px;
  font-size: var(--font-size-small);
  box-shadow: var(--shadow-popup);
  z-index: 1000;
  animation: fadeInToast 0.2s ease;
}

/* Translation panel (fixed below header, shown on sentence tap) */
.page__translation-panel {
  position: fixed;
  top: calc(var(--header-height, 60px) + env(safe-area-inset-top, 0px));
  left: 0;
  right: 0;
  z-index: 99;
  background: var(--color-surface, #fff);
  border-bottom: 1px solid var(--color-border, #e0e0e0);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);
  padding: var(--spacing-sm) var(--spacing-xl);
}

.page__translation-panel-text {
  margin: 0;
  font-size: 1.1em;
  color: var(--color-text-secondary);
  font-style: italic;
  text-align: center;
  line-height: 1.5;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

@keyframes fadeInToast {
  from {
    opacity: 0;
    transform: translateX(-50%) translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
  }
}

/* =============================================================================
   HOME PAGE
   ============================================================================= */

.home {
  position: relative;
  width: 100%;
  min-height: 100vh;
  max-width: 900px;
  margin: 0 auto;
  padding: 0 var(--spacing-xl) var(--spacing-lg);
  font-family: var(--font-main);
  background: #f5f5f5;
}

@media (min-width: 1200px) {
  .home {
    max-width: 1000px;
  }
  .home__hero-inner {
    max-width: 1000px;
  }
}

@media (min-width: 1600px) {
  .home {
    max-width: 1100px;
  }
  .home__hero-inner {
    max-width: 1100px;
  }
}

/* Hero Section */
.home__hero {
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  color: white;
  padding: 0;
  text-align: center;
  border-radius: 0;
  width: 100vw;
  position: relative;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 0;
  z-index: 10;
}

.home__hero-inner {
  max-width: 900px;
  margin: 0 auto;
  padding: 16px var(--spacing-xl) 0;
  text-align: left;
  display: flex;
  flex-direction: column;
}

.home__hero-top-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 12px;
  min-height: 66px;
}

.home__hero-logo {
  display: inline-block;
}

.home__avatar-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.25);
  border: 2px solid rgba(255, 255, 255, 0.6);
  color: #fff;
  font-size: 0.8rem;
  font-weight: 700;
  cursor: pointer;
  font-family: var(--font-main);
  transition: all 0.15s ease;
}

.home__avatar-btn:hover {
  background: rgba(255, 255, 255, 0.4);
}

.home__lang-selectors {
  display: flex;
  gap: clamp(24px, 5vw, 48px);
}

.home__lang-selector {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  position: relative;
}

.home__lang-selector-label {
  font-size: clamp(0.65rem, 1.2vw, 0.75rem);
  color: rgba(255, 255, 255, 0.7);
  font-weight: 500;
}

.home__lang-selector-value {
  font-size: clamp(0.8rem, 1.5vw, 0.95rem);
  color: #fff;
  font-weight: 700;
}

.home__lang-select-btn {
  background: none;
  border: none;
  color: #fff;
  font-size: clamp(0.8rem, 1.5vw, 0.95rem);
  font-weight: 700;
  font-family: var(--font-main);
  cursor: pointer;
  padding: 8px 0;
  min-height: 44px;
}

.home__lang-dropdown {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-top: 4px;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
  overflow: hidden;
  z-index: 100;
  min-width: 0;
  white-space: nowrap;
  max-width: calc(100vw - 32px);
}

.home__lang-dropdown-item {
  display: block;
  width: 100%;
  padding: 12px 16px;
  min-height: 44px;
  background: none;
  border: none;
  font-size: 0.9rem;
  font-family: var(--font-main);
  color: #333;
  cursor: pointer;
  text-align: left;
}

.home__lang-dropdown-item:hover {
  background: #f5f5f5;
}

.home__lang-dropdown-item--active {
  color: #dc2626;
  font-weight: 600;
}

.home__hero-logo-img {
  height: 32px;
  width: auto;
  filter: brightness(0) invert(1);
}

.home__logo {
  margin: 0 0 var(--spacing-sm) 0;
  font-size: 2.5rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing-sm);
}

.home__logo-icon {
  font-size: 2rem;
}

.home__logo-img {
  height: 68px;
  width: auto;
  filter: brightness(0) invert(1);
}

.home__tagline {
  margin: 0 0 var(--spacing-xs) 0;
  font-size: 1.1rem;
  opacity: 0.95;
}

/* User button in hero top */
.home__user-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: 20px;
  padding: 4px 12px 4px 4px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s ease;
}

.home__user-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}

.home__user-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  object-fit: cover;
}

.home__user-name {
  white-space: nowrap;
}

/* Telegram login in hero */
.home__login {
  margin-top: var(--spacing-md);
  display: flex;
  justify-content: center;
}

.home__google-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 24px;
  background: #fff;
  color: #333;
  border: none;
  border-radius: 12px;
  font-size: 0.95rem;
  font-weight: 500;
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  transition: box-shadow 0.2s;
}

.home__google-btn:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
}

.home__google-icon {
  flex-shrink: 0;
}

.home__subtitle {
  margin: 0;
  font-size: 0.9rem;
  opacity: 0.8;
  background: rgba(255, 255, 255, 0.2);
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  margin-top: var(--spacing-sm);
}

/* Content Section */
.home__content {
  width: 100%;
  padding-top: var(--spacing-lg);
}

.home__section-title {
  font-size: 1.5rem;
  margin: 0 0 var(--spacing-lg) 0;
  color: var(--color-text);
}

/* Lesson Cards */
.dialogues__search {
  position: relative;
  display: flex;
  align-items: center;
  margin-bottom: var(--spacing-md);
}

.dialogues__search-icon {
  position: absolute;
  left: 14px;
  color: #999;
  pointer-events: none;
}

.dialogues__search-input {
  width: 100%;
  padding: 12px 40px 12px 42px;
  border: none;
  border-radius: 12px;
  background: white;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  font-size: 0.95rem;
  font-family: inherit;
  color: #333;
  outline: none;
}

.dialogues__search-input::placeholder {
  color: #aaa;
}

.dialogues__search-input:focus {
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.12);
}

.dialogues__search-clear {
  position: absolute;
  right: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  border: none;
  border-radius: 50%;
  background: transparent;
  color: #999;
  cursor: pointer;
}

.dialogues__search-clear:hover {
  background: #f0f0f0;
  color: #666;
}

.dialogues__tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: var(--spacing-md);
}

.dialogues__tag {
  padding: 6px 14px;
  border-radius: 20px;
  border: 1px solid #ddd;
  background: white;
  color: #666;
  font-size: 0.82rem;
  cursor: pointer;
  white-space: nowrap;
  display: inline-flex;
  align-items: center;
  gap: 5px;
  min-height: 36px;
}

.dialogues__tag--active {
  background: var(--color-accent);
  color: white;
  border-color: var(--color-accent);
}

.dialogues__empty {
  text-align: center;
  color: #999;
  padding: var(--spacing-xl) 0;
  font-size: 0.95rem;
}

.dialogue-card {
  display: block;
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  padding: 16px 20px;
  text-decoration: none;
  color: inherit;
}

.dialogue-card__content {
  display: flex;
  align-items: flex-start;
  gap: 12px;
}

.dialogue-card__text {
  flex: 1;
  min-width: 0;
}

.dialogue-card__title {
  font-size: 1.15rem;
  font-weight: 600;
  margin: 0;
  color: #333;
  display: flex;
  align-items: center;
  gap: 8px;
}

.dialogue-card__new {
  font-size: 0.65rem;
  font-weight: 600;
  background: #dc2626;
  color: white;
  padding: 2px 7px;
  border-radius: 10px;
  text-transform: uppercase;
  letter-spacing: 0.02em;
  flex-shrink: 0;
}

.dialogue-card__pinyin {
  font-size: 0.85rem;
  color: var(--color-accent);
  margin: 2px 0 0;
  font-family: var(--font-pinyin);
}

.dialogue-card__translation {
  font-size: 0.85rem;
  color: #888;
  margin: 4px 0 0;
}

.dialogue-card__bookmark {
  background: none;
  border: none;
  padding: 4px;
  cursor: pointer;
  color: #ccc;
  flex-shrink: 0;
  margin-top: 2px;
}

.dialogue-card__bookmark--active {
  color: var(--color-accent);
}

.dialogue-card__tag {
  display: inline-block;
  font-size: 0.72rem;
  color: #999;
  background: #f0f0f0;
  padding: 2px 10px;
  border-radius: 10px;
  margin-top: 8px;
}

.home__lessons {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-md);
}

.lesson-card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  transition: all 0.2s ease;
}

.lesson-card:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  transform: translateY(-2px);
}

.lesson-card__header {
  display: flex;
  align-items: flex-start;
  gap: var(--spacing-md);
  padding: var(--spacing-md) var(--spacing-lg);
  border-bottom: 1px solid var(--color-border);
}

.lesson-card__number {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
  color: white;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1rem;
  font-weight: 700;
  flex-shrink: 0;
}

.lesson-card__title-group {
  flex: 1;
  min-width: 0;
}

.lesson-card__title {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  font-family: var(--font-cjk);
  color: var(--color-text);
}

.lesson-card__pinyin {
  margin: 2px 0 0 0;
  font-size: 0.9rem;
  color: var(--color-accent);
  font-style: italic;
}

.lesson-card__translation {
  margin: 4px 0 0 0;
  font-size: 0.85rem;
  color: var(--color-text-secondary);
}

.lesson-card__pages {
  display: flex;
  flex-wrap: wrap;
  gap: var(--spacing-sm);
  padding: var(--spacing-md) var(--spacing-lg);
  background: var(--color-background-section);
}

.lesson-card__page-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--spacing-sm) var(--spacing-md);
  background: white;
  border: 1px solid var(--color-border);
  border-radius: 8px;
  text-decoration: none;
  transition: all 0.15s ease;
  min-width: 64px;
}

.lesson-card__page-link:hover {
  background: var(--color-accent-light);
  border-color: var(--color-accent);
  transform: translateY(-1px);
}

.lesson-card__page-link--done {
  border-color: #22c55e;
  background: #f0fdf4;
}

.lesson-card__check {
  color: #22c55e;
  font-size: 0.75rem;
  font-weight: 700;
  line-height: 1;
}

.lesson-card__page-num {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-accent);
}

.lesson-card__page-label {
  font-size: 0.7rem;
  color: var(--color-text-secondary);
  text-transform: lowercase;
}

/* Flashcards link */
.home__flashcards-link {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md) var(--spacing-lg);
  margin-top: var(--spacing-lg);
  background: linear-gradient(135deg, #3182ce 0%, #2563eb 100%);
  color: white;
  text-decoration: none;
  border-radius: 12px;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(49, 130, 206, 0.3);
}

.home__flashcards-link:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 16px rgba(49, 130, 206, 0.4);
}

.home__flashcards-icon {
  font-size: 1.75rem;
  flex-shrink: 0;
}

.home__flashcards-text {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.home__flashcards-title {
  font-size: 1.1rem;
  font-weight: 600;
}

.home__flashcards-desc {
  font-size: 0.85rem;
  opacity: 0.9;
  margin-top: 2px;
}

.home__flashcards-arrow {
  font-size: 1.25rem;
  flex-shrink: 0;
  transition: transform 0.15s ease;
}

.home__flashcards-link:hover .home__flashcards-arrow {
  transform: translateX(4px);
}

/* Stats */
.home__stats {
  display: flex;
  justify-content: center;
  gap: var(--spacing-xl);
  margin-top: var(--spacing-xl);
  padding-top: var(--spacing-lg);
  border-top: 1px solid var(--color-border);
}

.home__stat {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
}

.home__stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--color-accent);
}

.home__stat-label {
  font-size: 0.85rem;
  color: var(--color-text-secondary);
}

/* Empty State */
.home__empty {
  max-width: 400px;
  margin: var(--spacing-xl) auto;
  padding: var(--spacing-xl);
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  text-align: center;
}

.home__empty-icon {
  font-size: 3rem;
  margin-bottom: var(--spacing-md);
}

.home__empty code {
  background: var(--color-border);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
}

/* Footer */
.home__footer {
  text-align: center;
  padding: var(--spacing-lg);
  color: var(--color-text-secondary);
  font-size: 0.85rem;
}

.home__footer p {
  margin: 0;
}

/* Back link in hero */
.home__back-link {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  font-size: 0.9rem;
  transition: color 0.15s ease;
}

.home__back-link:hover {
  color: white;
}

/* Hero top row: back link + language toggle */
.home__hero-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--spacing-sm);
}

.home__lang-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.4);
  border-radius: 6px;
  padding: 4px 12px;
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s ease;
}

.home__lang-btn:hover {
  background: rgba(255, 255, 255, 0.3);
}

/* Language Groups */
.home__languages {
  display: flex;
  flex-direction: column;
  gap: var(--spacing-xl);
}

.language-group {
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.language-group__header {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
  padding: var(--spacing-md) var(--spacing-lg);
  background: var(--color-background-section);
  border-bottom: 1px solid var(--color-border);
}

.language-group__flag {
  font-size: 2rem;
}

.language-group__title {
  display: flex;
  flex-direction: column;
}

.language-group__name {
  margin: 0;
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
}

.language-group__original {
  font-size: 0.9rem;
  color: var(--color-text-secondary);
}

.language-group__books {
  display: flex;
  flex-direction: column;
}

/* Book Card */
.book-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-md) var(--spacing-lg);
  text-decoration: none;
  color: inherit;
  transition: background 0.15s ease;
  border-bottom: 1px solid var(--color-border);
}

.book-card:last-child {
  border-bottom: none;
}

.book-card:hover {
  background: var(--color-background-hover);
}

.book-card__content {
  flex: 1;
}

.book-card__title {
  margin: 0 0 4px 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-accent);
}

.book-card__subtitle {
  margin: 0 0 4px 0;
  font-size: 0.9rem;
  font-weight: 500;
  color: var(--color-text);
}

.book-card__description {
  margin: 0;
  font-size: 0.85rem;
  color: var(--color-text-secondary);
}

.book-card__arrow {
  font-size: 1.25rem;
  color: var(--color-text-secondary);
  transition: transform 0.15s ease, color 0.15s ease;
}

.book-card:hover .book-card__arrow {
  transform: translateX(4px);
  color: var(--color-accent);
}

/* Language Group as Link (Home Page) */
.language-group--link {
  display: flex;
  align-items: center;
  justify-content: space-between;
  text-decoration: none;
  color: inherit;
  cursor: pointer;
  transition: all 0.2s ease;
  padding: var(--spacing-md) var(--spacing-lg);
}

.language-group--link:hover {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  transform: translateY(-2px);
}

.language-group--link .language-group__header {
  border-bottom: none;
  padding: 0;
  background: transparent;
}

.language-group__arrow {
  font-size: 1.25rem;
  color: var(--color-text-secondary);
  transition: transform 0.15s ease, color 0.15s ease;
  flex-shrink: 0;
}

.language-group--link:hover .language-group__arrow {
  transform: translateX(4px);
  color: var(--color-accent);
}

/* =============================================================================
   LANGUAGE PAGE (Tabs)
   ============================================================================= */

.lang-page__tabs {
  display: flex;
  justify-content: flex-start;
  gap: 4px;
  margin-top: auto;
  margin-bottom: 0;
  border-bottom: none;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  position: relative;
  z-index: 1;
}

.lang-page__tabs::-webkit-scrollbar {
  display: none;
}

.lang-page__tab {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: clamp(7px, 1.4vw, 10px) clamp(10px, 2vw, 18px);
  background: rgba(255, 255, 255, 0.35);
  border: none;
  border-radius: 4px 4px 0 0;
  font-size: clamp(14px, 1.5vw, 15px);
  font-weight: 500;
  color: rgba(255, 255, 255, 0.9);
  cursor: pointer;
  font-family: var(--font-main);
  white-space: nowrap;
  flex-shrink: 0;
  -webkit-tap-highlight-color: transparent;
  outline: none;
}

.lang-page__tab--active {
  background: #f5f5f5;
  color: #dc2626;
  margin-bottom: -1px;
}

.lang-page__tab--disabled {
  opacity: 0.5;
  cursor: default;
}

.lang-page__tab-icon {
  font-size: 1rem;
}

/* HSK Book Cards Grid */
.lang-page__books {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(clamp(140px, 25vw, 220px), 1fr));
  gap: clamp(8px, 1.5vw, 16px);
}

.lang-page__book-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: clamp(16px, 3vw, 32px) clamp(12px, 2.5vw, 24px);
  background: white;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  text-decoration: none;
  color: inherit;
  transition: all 0.2s ease;
  position: relative;
}

.lang-page__book-card:hover:not(.lang-page__book-card--disabled) {
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  transform: translateY(-2px);
}

.lang-page__book-card--disabled {
  opacity: 0.5;
  cursor: default;
}

.lang-page__book-level {
  font-size: clamp(1.8rem, 4vw, 2.5rem);
  font-weight: 700;
  color: #dc2626;
  line-height: 1;
}

.lang-page__book-level-label {
  font-size: 1em;
  font-weight: 700;
  color: inherit;
}

.lang-page__book-card--disabled .lang-page__book-level {
  color: var(--color-text-secondary);
}

.lang-page__book-title {
  font-size: clamp(0.9rem, 1.8vw, 1.1rem);
  font-weight: 600;
  margin-top: var(--spacing-sm);
  color: var(--color-text);
}

.lang-page__book-pinyin {
  font-size: clamp(0.75rem, 1.5vw, 0.9rem);
  color: var(--color-accent);
  font-style: italic;
}

.lang-page__book-subtitle {
  font-size: clamp(0.7rem, 1.4vw, 0.85rem);
  color: var(--color-text-secondary);
  margin-top: var(--spacing-xs);
}

.lang-page__coming-soon {
  position: absolute;
  top: var(--spacing-sm);
  right: var(--spacing-sm);
  padding: 2px 10px;
  background: #f59e0b;
  color: white;
  font-size: 0.75rem;
  font-weight: 600;
  border-radius: 4px;
}

/* Placeholder for empty tabs */
.lang-page__placeholder {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: calc(var(--spacing-xl) * 2);
  min-height: 200px;
  color: var(--color-text-secondary);
}

.lang-page__placeholder-icon {
  font-size: 3rem;
  margin-bottom: var(--spacing-md);
}

.lang-page__placeholder-text {
  font-size: 1.1rem;
  font-style: italic;
  margin: 0;
}

@media (max-width: 600px) {
  .lang-page__books {
    grid-template-columns: 1fr;
  }

  .home {
    padding: 0 12px var(--spacing-lg);
  }

  .home__hero-inner {
    padding: 12px 12px 0;
    max-width: 100%;
  }

  .home__hero-top-row {
    margin-bottom: 8px;
  }

  .home__lang-selectors {
    gap: 16px;
  }

  .home__hero-logo-img {
    height: 28px;
  }

  .home__lang-selector-label {
    font-size: 0.7rem;
  }

  .lang-page__tabs {
    gap: 3px;
  }

  .lang-page__tab {
    min-height: 36px;
    font-size: 0.8rem;
    flex: 1;
    justify-content: center;
    padding-left: 0;
    padding-right: 0;
  }

  .lang-page__book-card {
    border-radius: 8px;
  }
}

/* Mobile Responsive */
@media (max-width: 480px) {
  .home__hero {
    padding: 0;
  }

  .home__logo {
    font-size: 2rem;
  }

  .home__logo-img {
    height: 34px;
  }

  .home__content {
    padding: var(--spacing-lg) 0;
  }

  .lesson-card__header {
    padding: var(--spacing-md);
  }

  .lesson-card__number {
    width: 32px;
    height: 32px;
    font-size: 1rem;
  }

  .lesson-card__title {
    font-size: 1.1rem;
  }

  .lesson-card__pages {
    padding: var(--spacing-sm) var(--spacing-md);
  }

  .lesson-card__page-link {
    padding: var(--spacing-xs) var(--spacing-sm);
    min-width: 52px;
  }

  .home__stats {
    gap: var(--spacing-lg);
  }

  .lang-page__tab-icon {
    font-size: 0.85rem;
  }

  .lang-page__books {
    grid-template-columns: 1fr;
  }

  .lang-page__book-card {
    padding: var(--spacing-lg) var(--spacing-md);
  }

  .lang-page__book-level {
    font-size: 2rem;
  }
}

/* =============================================================================
   READER NAVIGATION
   ============================================================================= */

.reader {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.reader__header {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: calc(var(--header-height) + env(safe-area-inset-top, 0px));
  background: rgba(245, 245, 245, 0.97);
  border-bottom: 1px solid var(--color-border);
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  z-index: 100;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  padding-top: env(safe-area-inset-top, 0px);
}

.reader__header-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: var(--header-height);
  max-width: 900px;
  margin: 0 auto;
  padding: 0 var(--spacing-xl);
}

@media (min-width: 1200px) {
  .reader__header-inner {
    max-width: 1000px;
  }
}

@media (min-width: 1600px) {
  .reader__header-inner {
    max-width: 1100px;
  }
}

.reader__header * {
  font-family: inherit;
}

.reader__home {
  font-weight: 600;
  color: var(--color-text);
  text-decoration: none;
  display: flex;
  align-items: center;
}

.reader__home-logo {
  height: 28px;
  width: auto;
}

.reader__home:hover {
  opacity: 0.7;
}

.reader__page-nav {
  display: flex;
  align-items: center;
  gap: var(--spacing-md);
}

.reader__location {
  font-size: var(--font-size-small);
  color: var(--color-text-secondary);
}

.reader__nav-toggles {
  display: flex;
  gap: 8px;
}

.reader__nav-toggle {
  padding: 8px 14px;
  min-height: 44px;
  font-size: 0.85rem;
  font-weight: 500;
  color: var(--color-text-secondary);
  background: transparent;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.15s ease;
}

.reader__nav-toggle--active {
  color: white;
  background: var(--color-accent);
  border-color: var(--color-accent);
}

.reader__nav-btn {
  padding: var(--spacing-sm) 0.75rem;
  min-height: 44px;
  display: flex;
  align-items: center;
  font-size: var(--font-size-small);
  color: var(--color-accent);
  text-decoration: none;
  border: 1px solid var(--color-border);
  border-radius: 4px;
  transition: all 0.15s ease;
}

.reader__nav-btn:hover {
  background: var(--color-accent-light);
  border-color: var(--color-accent);
}

.reader__nav-btn--disabled {
  color: #ccc;
  cursor: not-allowed;
}

.reader__nav-btn--disabled:hover {
  background: transparent;
  border-color: var(--color-border);
}

.reader__bottom-nav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: calc(var(--bottom-nav-height) + env(safe-area-inset-bottom, 0px));
  background: rgba(245, 245, 245, 0.97);
  border-top: 1px solid var(--color-border);
  font-family: var(--font-main);
  z-index: 100;
  backdrop-filter: blur(8px);
  -webkit-backdrop-filter: blur(8px);
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

.reader__bottom-nav-inner {
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: var(--bottom-nav-height);
  max-width: 900px;
  margin: 0 auto;
  padding: 0 var(--spacing-xl);
}

@media (min-width: 1200px) {
  .reader__bottom-nav-inner {
    max-width: 1000px;
  }
}

@media (min-width: 1600px) {
  .reader__bottom-nav-inner {
    max-width: 1100px;
  }
}

.reader__bottom-nav .reader__location {
  flex: 1;
  text-align: center;
}

@media (max-width: 600px) {
  .reader__header-inner {
    height: var(--header-height);
    gap: var(--spacing-sm);
    padding: 0 var(--spacing-md);
  }

  .reader__home {
    font-size: 15px;
  }

  .reader__controls {
    gap: 6px;
  }

  .reader__bottom-nav-inner {
    height: var(--bottom-nav-height);
    padding: 0 var(--spacing-md);
  }

  .reader__bottom-nav .reader__nav-btn {
    font-size: 13px;
    padding: 6px 10px;
  }

  .reader__bottom-nav .reader__location {
    font-size: 12px;
  }
}

/* =============================================================================
   NOT FOUND PAGE
   ============================================================================= */

.not-found {
  max-width: 720px;
  margin: 0 auto;
  padding: 4rem var(--spacing-xl);
  text-align: center;
  font-family: var(--font-main);
}

.not-found h1 {
  margin: 0 0 var(--spacing-md) 0;
  color: var(--color-text);
}

.not-found p {
  margin: 0 0 var(--spacing-xl) 0;
  color: var(--color-text-secondary);
}

.not-found a {
  display: inline-block;
  padding: 0.75rem 1.5rem;
  background: var(--color-accent);
  color: white;
  text-decoration: none;
  border-radius: 6px;
  transition: background 0.15s ease;
}

.not-found a:hover {
  background: #2c5282;
}

/* =============================================================================
   GUIDED LESSON FLOW
   Step-by-step lesson layout inspired by Headway-style textbooks.
   Shows one section at a time with progress bar and navigation.
   ============================================================================= */

.guided {
  --font-scale: 1;
  position: relative;
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
  padding: var(--spacing-lg) var(--spacing-xl);
  padding-top: calc(var(--header-height) + var(--spacing-md) + env(safe-area-inset-top, 0px));
  padding-bottom: calc(var(--spacing-xl) + env(safe-area-inset-bottom, 0px));
  font-family: var(--font-main);
  font-size: calc(var(--font-size-base) * var(--font-scale));
  line-height: var(--line-height);
  color: var(--color-text);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Progress bar — thin bar at top */
.guided__progress-bar {
  width: 100%;
  height: 4px;
  background: var(--color-border);
  border-radius: 2px;
  overflow: hidden;
  margin-bottom: var(--spacing-sm);
}

.guided__progress-fill {
  height: 100%;
  background: var(--color-accent);
  border-radius: 2px;
  transition: width 0.3s ease;
}

/* Step dots — clickable dot navigation */
.guided__step-dots {
  display: flex;
  justify-content: center;
  gap: 8px;
  margin-bottom: var(--spacing-lg);
}

.guided__dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 2px solid var(--color-border);
  background: transparent;
  padding: 0;
  cursor: pointer;
  transition: all 0.2s ease;
}

.guided__dot:hover {
  border-color: var(--color-accent);
}

.guided__dot--active {
  background: var(--color-accent);
  border-color: var(--color-accent);
  transform: scale(1.2);
}

.guided__dot--done {
  background: var(--color-accent);
  border-color: var(--color-accent);
  opacity: 0.5;
}

/* Step header — big number + instruction */
.guided__step-header {
  display: flex;
  align-items: baseline;
  gap: var(--spacing-md);
  margin-bottom: var(--spacing-lg);
}

.guided__step-number {
  font-size: 2.5em;
  font-weight: 800;
  color: var(--color-accent);
  line-height: 1;
  flex-shrink: 0;
  min-width: 1.2em;
}

.guided__step-instruction {
  font-size: 1.15em;
  color: var(--color-text-secondary);
  font-weight: 500;
  line-height: 1.4;
}

/* Step layout — two columns when image present */
.guided__step-layout {
  flex: 1;
  margin-bottom: var(--spacing-xl);
}

.guided__step-layout--with-image {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--spacing-xl);
  align-items: start;
}

.guided__step-main {
  min-width: 0;
}

/* Step image — right column */
.guided__step-image {
  border-radius: 12px;
  overflow: hidden;
}

.guided__step-image img {
  width: 100%;
  height: auto;
  display: block;
  border-radius: 12px;
  object-fit: cover;
}

/* Step content — the section itself */
.guided__step-content {
  border-radius: 10px;
  padding: var(--spacing-md);
}

/* Remove duplicate section header in guided mode */
.guided__step-content .section__header {
  display: none;
}

/* --- Dialogue card style (bordered box like textbook) --- */
.guided__step-content--dialogue {
  border: 1.5px solid var(--color-border);
  background: #fff;
}

.guided__step-content--dialogue .section__context {
  padding-bottom: var(--spacing-sm);
  margin-bottom: var(--spacing-sm);
  border-bottom: 1px solid var(--color-border);
  font-style: italic;
  color: var(--color-text-secondary);
}

/* --- Grammar box (colored background, accent left border) --- */
.guided__step-content--grammar {
  background: #eef4fd;
  border-left: 4px solid var(--color-accent);
}

/* --- Vocabulary (clean list, subtle background) --- */
.guided__step-content--vocab {
  background: #f0faf0;
  border-left: 4px solid #38a169;
}

/* --- Exercise / fill-blank (speech bubble style) --- */
.guided__step-content--exercise {
  background: #fefce8;
  border: 1.5px solid #eab308;
  border-radius: 12px;
  position: relative;
}

/* --- Objectives (premium card design) --- */
.guided__step-content--objectives {
  background: #F7F6F3;
  border-left: none;
  padding: 0;
  border-radius: 16px;
  overflow: hidden;
}

/* Hide step number/instruction for objectives — the red banner replaces it */
.guided__step-main:has(.guided__step-content--objectives) .guided__step-header {
  display: none;
}

/* Show section header for objectives in guided mode (override the global hide) */
.guided__step-content--objectives .section__header {
  display: inline-flex !important;
  align-items: center;
  gap: var(--spacing-md);
  background: linear-gradient(135deg, #C43A35 0%, #B7332E 100%);
  border-radius: 0 0 12px 0;
  padding: 12px 24px;
  margin-bottom: 0;
}

.guided__step-content--objectives .section__heading {
  font-size: 1.6em;
  font-weight: 700;
  letter-spacing: 0.05em;
}

.guided__step-content--objectives .section__subheading {
  font-size: 1.1em;
  font-weight: 500;
  border-left: 2px solid rgba(255, 255, 255, 0.5);
}

/* Objectives sentences container — padding around cards */
.guided__step-content--objectives .section__sentences {
  padding: 16px;
  gap: 16px;
  background: transparent;
}

/* Each objective as a floating card */
.guided__step-content--objectives .sentence {
  background: #fff;
  border-radius: 16px;
  padding: 18px 18px 18px 22px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06), 0 2px 12px rgba(0, 0, 0, 0.03);
  border-left: 4px solid #C43A35;
  display: block;
}

/* Hide the checkbox squares — the red accent bar replaces them */
.guided__step-content--objectives .sentence__checkbox {
  display: none;
}

/* Chinese text — bold, larger */
.guided__step-content--objectives .sentence__text {
  font-size: calc(18px * var(--font-scale, 1));
  font-weight: 600;
  color: #1a1a1a;
  line-height: 1.55;
  display: block;
}

/* Translation below — muted gray, smaller */
.guided__step-content--objectives .sentence__translation-inline {
  font-size: calc(14px * var(--font-scale, 1));
  color: #666;
  font-weight: 400;
  line-height: 1.55;
  margin-top: 8px;
  padding-left: 0;
  font-style: normal;
}

/* Remove default section__content rounding/padding for objectives */
.guided__step-content--objectives .section__content {
  border-radius: 0;
  padding: 0;
}

/* Sentence body — let text block fill naturally */
.guided__step-content--objectives .sentence__body {
  display: block;
}

/* --- Tip box --- */
.guided__step-content--tip {
  background: #fff7ed;
  border-left: 4px solid #dd6b20;
}

/* Navigation — bottom bar with back/next */
.guided__nav {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: var(--spacing-md) 0;
  border-top: 1px solid var(--color-border);
  margin-top: auto;
}

.guided__step-counter {
  font-size: var(--font-size-small);
  color: var(--color-text-secondary);
  font-weight: 500;
}

.guided__nav-btn {
  display: inline-flex;
  align-items: center;
  gap: var(--spacing-xs);
  padding: 0.6em 1.2em;
  border-radius: 8px;
  font-size: 0.95em;
  font-weight: 600;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.15s ease;
  border: none;
}

.guided__nav-btn--primary {
  background: var(--color-accent);
  color: white;
}

.guided__nav-btn--primary:hover {
  background: #2c5282;
}

.guided__nav-btn--secondary {
  background: transparent;
  color: var(--color-accent);
  border: 1.5px solid var(--color-border);
}

.guided__nav-btn--secondary:hover {
  border-color: var(--color-accent);
  background: var(--color-accent-light);
}

/* Responsive */
@media (max-width: 768px) {
  .guided {
    padding-left: var(--spacing-md);
    padding-right: var(--spacing-md);
  }

  .guided__step-number {
    font-size: 2em;
  }

  .guided__nav-btn {
    padding: 0.5em 0.8em;
    font-size: 0.85em;
  }

  /* Stack image below content on mobile */
  .guided__step-layout--with-image {
    grid-template-columns: 1fr;
  }

  .guided__step-image {
    order: -1;
    max-height: 250px;
  }

  .guided__step-image img {
    max-height: 250px;
    object-fit: cover;
  }
}

@media (min-width: 1200px) {
  .guided {
    max-width: 1000px;
  }
}

@media (min-width: 1600px) {
  .guided {
    max-width: 1100px;
  }
}

/* ==========================================
   LANDING PAGE
   ========================================== */

.landing {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Nav */
.landing__nav {
  position: sticky;
  top: 0;
  z-index: 100;
  background: #fff;
  border-bottom: 1px solid #e5e7eb;
}

.landing__nav-inner {
  max-width: 1200px;
  margin: 0 auto;
  padding: 18px 32px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.landing__nav-logo {
  display: flex;
  align-items: center;
}

.landing__nav-logo-img {
  height: 28px;
  width: auto;
}

.landing__nav-links {
  display: flex;
  align-items: center;
  gap: 32px;
}

.landing__nav-link {
  font-size: 1.1rem;
  font-weight: 500;
  color: #4b5563;
  text-decoration: none;
  padding: 4px 0;
  border-bottom: 2px solid transparent;
  transition: color 0.15s, border-color 0.15s;
}

.landing__nav-link:hover {
  color: #1a1a1a;
  border-bottom-color: var(--color-accent);
}

.landing__nav-right {
  display: flex;
  align-items: center;
  gap: 12px;
}

.landing__lang-btn {
  padding: 6px 14px;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background: #fff;
  font-size: 0.85rem;
  font-weight: 600;
  color: #6b7280;
  cursor: pointer;
}

.landing__login-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 24px;
  background: #fff;
  border: 2px solid var(--color-accent);
  border-radius: 8px;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-accent);
  cursor: pointer;
  transition: background 0.15s, color 0.15s;
}

.landing__login-btn:hover {
  background: var(--color-accent);
  color: #fff;
}

/* Hamburger - hidden on desktop */
.landing__hamburger {
  display: none;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  gap: 5px;
  width: 36px;
  height: 36px;
  padding: 6px;
  background: none;
  border: none;
  cursor: pointer;
  font-size: 1.4rem;
  color: #1a1a1a;
}

.landing__hamburger span {
  display: block;
  height: 2px;
  width: 100%;
  background: #1a1a1a;
  border-radius: 1px;
}

/* Mobile dropdown menu (inside nav, full-width) */
.landing__mobile-menu {
  display: none;
  border-top: 1px solid #e5e7eb;
  background: #f8f7f4;
  padding: 12px 24px;
}

.landing__mobile-link {
  display: block;
  padding: 16px 8px;
  font-size: 1.15rem;
  font-weight: 600;
  color: #1a1a1a;
  text-decoration: none;
  border-bottom: 1px solid #e5e7eb;
}

.landing__mobile-link:last-child {
  border-bottom: none;
}

.landing__mobile-link--active {
  color: var(--color-accent);
  border-bottom: 3px solid var(--color-accent);
}

.landing__user-btn {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 4px 12px 4px 4px;
  background: #f3f4f6;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-size: 0.9rem;
  color: #333;
}

.landing__user-avatar {
  width: 28px;
  height: 28px;
  border-radius: 50%;
}

.landing__user-name {
  font-weight: 500;
}

/* Hero */
.landing__hero {
  text-align: center;
  padding: 80px 24px var(--hero-padding-bottom);
  max-width: none;
  width: 100%;
  margin: 0;
  background: var(--color-accent);
  color: #fff;
}

.landing__hero-title {
  font-size: 2.8rem;
  font-weight: 800;
  color: #fff;
  line-height: 1.2;
  margin: 0 0 16px;
  transform: translateY(250px);
}

.landing__hero-subtitle {
  font-size: 1.2rem;
  color: rgba(255, 255, 255, 0.85);
  line-height: 1.6;
  margin: 0 0 32px;
}

.landing__hero-cta {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 14px 32px;
  background: #fff;
  color: #1a1a1a;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.2s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.landing__hero-cta:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

/* Demo card */
.landing__hero-visual {
  margin-top: 48px;
  position: relative;
  height: 200px;
}

.landing__demo-card {
  position: absolute;
  text-align: left;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 16px;
  padding: 24px 32px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  left: 50%;
  transform: translateX(-550px) translateY(-100px);
}

.landing__demo-card--second {
  transform: translateX(-250px) translateY(275px);
}

.landing__demo-card--third {
  transform: translateX(350px) translateY(25px);
  white-space: nowrap;
}

.landing__demo-highlight {
  background: var(--color-accent);
  color: #fff;
  padding: 2px 6px;
  border-radius: 4px;
  position: relative;
}

.landing__demo-tooltip {
  position: absolute;
  top: -32px;
  left: 50%;
  transform: translateX(-50%);
  color: var(--color-accent);
  font-size: 1rem;
  font-style: italic;
  white-space: nowrap;
}

.landing__demo-tooltip::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid var(--color-accent);
}

.landing__demo-line--large {
  font-size: 1.8rem;
  margin-bottom: 0;
  color: #1a1a1a;
}

.landing__demo-cursor {
  position: absolute;
  bottom: -24px;
  right: -18px;
  width: 36px;
  height: 36px;
  filter: drop-shadow(0 1px 3px rgba(0,0,0,0.3));
}

.landing__demo-line {
  margin-bottom: 6px;
}

.landing__demo-chinese {
  font-size: 1.5rem;
  color: #1a1a1a;
  font-weight: 500;
}

.landing__demo-line--pinyin {
  font-size: 1rem;
  color: var(--color-accent);
  font-style: italic;
}

.landing__demo-line--translation {
  font-size: 0.95rem;
  color: #6b7280;
  font-style: italic;
}

/* Feature showcase — tap to translate */
.landing__showcase {
  padding: 80px 24px 60px;
  background: #fff;
}

.landing__showcase-content {
  max-width: 900px;
  margin: 0 auto;
  text-align: center;
}

.landing__showcase-title {
  font-size: 2.2rem;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0 0 12px;
}

.landing__showcase-subtitle {
  font-size: 1.1rem;
  color: #6b7280;
  margin: 0 0 48px;
  line-height: 1.5;
}

.landing__showcase-demo {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.landing__showcase-card {
  background: #f5f5f0;
  border: 1px solid #e5e5e0;
  border-radius: 16px;
  padding: 32px 40px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
  display: inline-block;
}

.landing__showcase-line {
  font-size: 1.8rem;
  color: #1a1a1a;
  white-space: nowrap;
}

.landing__showcase-highlight {
  background: var(--color-accent);
  color: #fff;
  padding: 2px 8px;
  border-radius: 4px;
  position: relative;
}

.landing__showcase-tooltip {
  position: absolute;
  top: -34px;
  left: 50%;
  transform: translateX(-50%);
  color: var(--color-accent);
  font-size: 1.1rem;
  font-style: italic;
  white-space: nowrap;
}

.landing__showcase-tooltip::after {
  content: '';
  position: absolute;
  bottom: -6px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 6px solid transparent;
  border-right: 6px solid transparent;
  border-top: 6px solid var(--color-accent);
}

.landing__showcase-cursor {
  position: absolute;
  bottom: -20px;
  right: -14px;
  width: 28px;
  height: 28px;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2));
}

.landing__showcase-arrows {
  width: 600px;
  height: 250px;
  margin-top: -10px;
}

.landing__showcase-labels {
  display: flex;
  justify-content: space-between;
  width: 600px;
  margin-top: -20px;
}

.landing__showcase-label {
  font-size: 1.2rem;
  font-weight: 700;
  color: #333;
  max-width: 200px;
  line-height: 1.3;
}

/* Hero language cards (dark overlay) — DESKTOP */
.landing__hero-langs {
  margin-top: 48px;
  margin-bottom: var(--hero-card-margin-bottom);
  transform: translateY(var(--hero-card-translateY));
  position: relative;
  z-index: 1;
}

.landing__hero-langs-inner {
  display: inline-flex;
  flex-direction: column;
  align-items: center;
  background: #1a2e1a;
  border-radius: 24px;
  padding: 48px 48px;
  gap: 28px;
}

.landing__hero-langs-row {
  display: flex;
  justify-content: center;
  gap: 36px;
}

.landing__hero-lang {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  text-decoration: none;
}

.landing__hero-lang-flag {
  width: 96px;
  height: 64px;
  object-fit: cover;
  border-radius: 8px;
}

.landing__hero-lang-name {
  font-size: 1rem;
  font-weight: 600;
  color: #fff;
}

.landing__hero-langs-more {
  font-size: 1.15rem;
  font-weight: 700;
  color: #fff;
  margin: 0;
}

/* Sections */
.landing__section {
  padding: 60px 24px;
  max-width: 1000px;
  margin: 0 auto;
  width: 100%;
  box-sizing: border-box;
}

.landing__section--gray {
  background: #f9fafb;
  max-width: none;
  padding-top: 320px;
}

.landing__section--gray .landing__section-title,
.landing__section--gray .landing__steps {
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}

.landing__section-title {
  text-align: center;
  font-size: 1.8rem;
  font-weight: 700;
  color: #1a1a1a;
  margin: 0 0 40px;
}

/* Language cards */
.landing__languages {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
}

.landing__lang-card {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 16px 28px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  text-decoration: none;
  color: #333;
  transition: box-shadow 0.2s, transform 0.15s;
}

.landing__lang-card:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
}

.landing__lang-flag {
  font-size: 2rem;
}

.landing__lang-name {
  font-size: 1.05rem;
  font-weight: 600;
}

.landing__lang-original {
  font-size: 0.9rem;
  color: #9ca3af;
}

/* Steps */
.landing__steps {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
}

.landing__step {
  text-align: center;
  padding: 32px 20px;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
}

.landing__step-icon {
  font-size: 2.5rem;
  margin-bottom: 12px;
}

.landing__step-num {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: var(--color-accent);
  color: #fff;
  border-radius: 50%;
  font-size: 0.85rem;
  font-weight: 700;
  margin-bottom: 12px;
}

.landing__step-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #1a1a1a;
  margin: 0 0 8px;
}

.landing__step-desc {
  font-size: 0.95rem;
  color: #6b7280;
  line-height: 1.5;
  margin: 0;
}

/* Features */
.landing__features {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
}

.landing__feature {
  padding: 24px;
  background: #fff;
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  text-align: center;
}

.landing__feature-icon {
  font-size: 2rem;
  margin-bottom: 12px;
}

.landing__feature-title {
  font-size: 1.05rem;
  font-weight: 600;
  color: #1a1a1a;
  margin: 0 0 8px;
}

.landing__feature-desc {
  font-size: 0.9rem;
  color: #6b7280;
  line-height: 1.5;
  margin: 0;
}

/* CTA */
.landing__cta {
  text-align: center;
  padding: 60px 24px;
  background: linear-gradient(135deg, #3182ce 0%, #2563eb 100%);
  color: #fff;
}

.landing__cta-title {
  font-size: 2rem;
  font-weight: 700;
  margin: 0 0 12px;
}

.landing__cta-subtitle {
  font-size: 1.1rem;
  opacity: 0.9;
  margin: 0 0 28px;
}

.landing__cta-btn {
  display: inline-flex;
  align-items: center;
  gap: 10px;
  padding: 14px 32px;
  background: #fff;
  color: #333;
  border: none;
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: transform 0.15s, box-shadow 0.2s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.landing__cta-btn:hover {
  transform: translateY(-1px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}

/* Footer */
.landing__footer {
  text-align: center;
  padding: 32px 24px;
  background: #1a1a1a;
  color: #9ca3af;
  margin-top: auto;
}

.landing__footer-text {
  margin: 0;
  font-size: 0.9rem;
}

/* Mobile responsive */
@media (max-width: 768px) {
  .landing__hero {
    max-width: none;
    width: 100%;
    margin: 0;
    --hero-padding-bottom: 440px;
    --hero-card-margin-bottom: -380px;
    --hero-card-translateY: 200px;
    padding-top: 260px !important;
    background: var(--color-accent);
  }

  .landing__hero-title {
    font-size: 1.8rem;
    color: #fff;
    transform: translateY(20px);
  }

  .landing__hero-subtitle {
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.85);
  }

  .landing__hero-cta {
    background: #fff;
    color: #1a1a1a;
    box-shadow: none;
  }

  .landing__hero-cta:hover {
    box-shadow: none;
    transform: none;
  }

  .landing__hero-cta svg path {
    fill: currentColor;
  }

  .landing__hero-visual {
    display: none;
  }

  .landing__demo-chinese {
    color: #fff;
  }

  .landing__demo-line--pinyin {
    color: rgba(255, 255, 255, 0.8);
  }

  .landing__demo-line--translation {
    color: rgba(255, 255, 255, 0.7);
  }

  .landing__hero-langs-inner {
    padding: 24px 20px;
  }

  .landing__hero-langs {
    margin-left: 16px;
    margin-right: 16px;
  }

  .landing__hero-langs-inner {
    display: flex;
    width: 100%;
    padding: 36px 24px;
    gap: 24px;
  }

  .landing__hero-langs-row {
    gap: 24px;
  }

  .landing__hero-lang-flag {
    width: 72px;
    height: 48px;
    border-radius: 6px;
  }

  .landing__hero-lang-name {
    font-size: 0.85rem;
  }

  .landing__hero-langs-more {
    font-size: 1rem;
  }

  .landing__steps {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .landing__features {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .landing__section {
    padding: 40px 20px;
  }

  .landing__section--gray {
    padding-top: 115px;
  }

  .landing__showcase {
    padding: 48px 20px 40px;
  }

  .landing__showcase-title {
    font-size: 1.6rem;
  }

  .landing__showcase-subtitle {
    font-size: 1rem;
    margin-bottom: 32px;
  }

  .landing__showcase-card {
    padding: 24px 20px;
  }

  .landing__showcase-line {
    font-size: 1.4rem;
  }

  .landing__showcase-arrows {
    display: none;
  }

  .landing__showcase-labels {
    flex-direction: column;
    width: auto;
    gap: 16px;
    margin-top: 32px;
    align-items: center;
  }

  .landing__showcase-label {
    font-size: 1rem;
    max-width: none;
  }

  .landing__section-title {
    font-size: 1.4rem;
    margin-bottom: 24px;
  }

  .landing__nav-links {
    display: none;
  }

  .landing__login-btn {
    padding: 8px 16px;
    font-size: 0.9rem;
    border-width: 1.5px;
  }

  .landing__lang-btn {
    padding: 5px 10px;
    font-size: 0.8rem;
  }

  .landing__hamburger {
    display: flex;
  }

  .landing__mobile-menu {
    display: block;
  }

  .landing__demo-card {
    padding: 16px 20px;
  }

  .landing__demo-chinese {
    font-size: 1.2rem;
  }
}

@media (max-width: 480px) {
  .landing__hero-title {
    font-size: 1.5rem;
  }

  .landing__languages {
    flex-direction: column;
    align-items: stretch;
  }

  .landing__nav-inner {
    padding: 10px 16px;
  }
}
